var e=Promise.withResolvers.bind(Promise),t=(t=e=>e)=>{const r=new Map;let s=0;return[()=>{let n;do{n=t(s++)}while(r.has(n));const a=e();return r.set(n,a),[n,a.promise]},(e,t,s)=>{const n=r.get(e);r.delete(e),s?n?.reject(s):n?.resolve(t)}]};let r=0;const s=r++,n=r++;r++;const a=r++,o=r++,c=r++,i=r++,l=r++,u=r++,f=r++,p=r++,g=r++,d=r++,h=r++,w=r++,y=r++,m=r++,b=r++,M=r++,S=r++,v=r++,T=r++,B=r++,x=r++,E=r++,A=r++,L=r++,R=r++;const D=globalThis.ImageData||class{},I=new TextDecoder;new TextEncoder,new Map(Reflect.ownKeys(Symbol).map(e=>[Symbol[e],`@${String(e)}`]));const P=Object.defineProperty,U=new ArrayBuffer(8),$=new DataView(U),O=new Uint8Array(U),j=(e,t,r)=>(e.set(t,r),r),k=e=>{O[0]=e[W++],O[1]=e[W++],O[2]=e[W++],O[3]=e[W++],O[4]=e[W++],O[5]=e[W++],O[6]=e[W++],O[7]=e[W++]},N=e=>(O[0]=e[W++],O[1]=e[W++],O[2]=e[W++],O[3]=e[W++],$.getUint32(0,!0)),F=(e,t)=>{switch(e[W++]){case o:return k(e),$.getFloat64(0,!0);case c:return e[W++];case v:{const r=j(t,W-1,{});for(let s=0,n=N(e);s<n;s++)r[F(e,t)]=F(e,t);return r}case y:{const r=j(t,W-1,[]);for(let s=0,n=N(e);s<n;s++)r.push(F(e,t));return r}case x:{const r=W-1,s=F(e,t);return j(t,r,new globalThis[s](F(e,t)))}case m:{const r=W-1,s=N(e);return j(t,r,e.slice(W,W+=s).buffer)}case h:{const r=W-1,s=N(e);return j(t,r,I.decode(e.slice(W,W+=s)))}case b:return j(t,W-1,new Date(F(e,t)));case S:{const r=j(t,W-1,new Map);for(let s=0,n=N(e);s<n;s++)r.set(F(e,t),F(e,t));return r}case B:{const r=j(t,W-1,new Set);for(let s=0,n=N(e);s<n;s++)r.add(F(e,t));return r}case M:{const r=F(e,t),s=F(e,t),n=F(e,t),a=new(globalThis[r]||Error)(s);return j(t,W-1,P(a,"stack",{value:n}))}case E:{const r=F(e,t),s=F(e,t),n=F(e,t),a=F(e,t),o=F(e,t);return j(t,W-1,new D(r,s,n,{colorSpace:a,pixelFormat:o}))}case T:{const r=F(e,t),s=F(e,t);return j(t,W-1,new RegExp(r,s))}case s:return!1;case n:return!0;case i:return NaN;case l:return 1/0;case u:return-1/0;case f:return 0;case p:return-0;case a:return null;case g:return k(e),$.getBigInt64(0,!0);case d:return k(e),$.getBigUint64(0,!0);case w:return(e=>{switch(e[0]){case"@":return Symbol[e.slice(1)];case"#":return Symbol.for(e.slice(1));case"!":return Symbol(e.slice(1));default:return Symbol()}})(F(e,t));case R:return t.get(N(e));case A:{const r=F(e,t),s=F(e,t);return j(t,W-1,new Blob([e.slice(W,W+=s)],{type:r}))}case L:{const r=W-1,s=F(e,t),n=F(e,t),a=F(e,t);return j(t,r,new File([a],s,{type:a.type,lastModified:n}))}default:return}};let W=0;const _=({byteOffset:e=0}={})=>(t,r)=>{return s=new Uint8Array(r,e,t),W=0,F(s,new Map);var s},q=[],z=new WeakSet,C=(...e)=>(z.add(e),e);let{SharedArrayBuffer:H}=globalThis,J=!0;try{new H(4,{maxByteLength:8})}catch(e){J=!1,H=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const{create:K}=Object,V=`coincident-${J?crypto.randomUUID():Math.random().toString(36).substring(2)}`,X=2*Int32Array.BYTES_PER_ELEMENT,Y={byteOffset:X},G=(e,t,r)=>{const s="then"!==t;return s&&(e[t]=r),s},Q=e=>{e.stopImmediatePropagation(),e.preventDefault()},[Z,ee]=t();let[te,re]=Z(),se=()=>re,ne=()=>{},{Atomics:ae,MessagePort:oe,SharedArrayBuffer:ce,postMessage:ie}=globalThis;if(J)ee(te);else{ce=H;const e=new Map,t=(e,...t)=>{e.addEventListener(...t)};if("importScripts"in globalThis){ne=t=>{e.set(t,null)};const r=t=>{const r=t[0],s=f++;return e.set(r,s),[s,r,t]},s=ie;ie=function(e,t){if(u){const n={ID:e.ID,data:r(e.data)};s(n,t)}else re.then(()=>this.postMessage(e,t))},oe=class extends oe{postMessage(e,t){u?super.postMessage(r(e),t):re.then(()=>this.postMessage(e,t))}},t(globalThis,"message",e=>{Q(e),ee(te,e.data)},{once:!0});const{wait:n}=ae,{parse:a}=JSON,o=t=>{const r=new XMLHttpRequest;try{if(r.timeout=3e3,r.open("POST",`${l}?sabayon`,!1),r.setRequestHeader("Content-Type","application/json"),r.send(`["${i}",${e.get(t)}]`),200===r.status)return r;throw r}catch{return r.abort(),o(t)}},c=(e,t)=>(e.set(a(t.responseText)),"ok");ae={wait:(t,...r)=>e.has(t)?c(t,o(t)):n(t,...r)};let i,l,u=!1,f=Math.random();re=re.then(e=>{[i,l]=e,u=!0})}else{const r=[V,Math.random()].join("-").replace(/\W/g,"-"),s=new BroadcastChannel("dc78209b-186c-4f83-80e9-406becb7d9f3");s.onmessage=async t=>{const[n,a,o]=t.data;if(a===r)for(const[t,[r,a]]of e)if(r===o){await a.promise;let e=t.length;for(;e--&&!t[e];);s.postMessage([n,t.slice(0,e+1)]);break}};const{notify:n}=ae;ae={notify(t,...r){const s=e.get(t);return s?(s[1].resolve(),0):n(t,...r)}};let a="",o=null;const c=(e,r)=>{let s,n=!0;e.getRegistration(a).then(t=>t??e.register(a,r)).then(function r(o){const{controller:c}=e;if(n=n&&!!c,s=o.installing||o.waiting||o.active,"activated"===s.state){if(n){if(c.scriptURL===a)return ee(te);o.unregister()}location.reload()}else t(s,"statechange",()=>r(o),{once:!0})})};se=(e,t)=>{if(!o){const r=new URL(e,location.href);a=`${r.protocol}//${r.host}${r.pathname}`,c(navigator.serviceWorker,t),o=re}return o}}}const{setPrototypeOf:le}=Reflect;let{postMessage:ue}=globalThis;const fe=e(),pe=oe.prototype;addEventListener("message",e=>{Q(e);const[t,r,s]=e.data,[n]=e.ports;r&&(le(n,pe),t&&(ue=ie)),fe.resolve([t,r,s,n])},{once:!0});var ge=async e=>{const[r,s,n,a]=await se().then(()=>fe.promise),o=!!r,c=J||!!s,i=e?.transform,l=(e?.decoder||_)(Y),u=!1!==e?.transfer;let f,p,g,d;if(c){const t=new(s?ce:SharedArrayBuffer)(e?.minByteLength||32767,{maxByteLength:e?.maxByteLength||16777216});f=new Int32Array(t),s?(({wait:d}=ae),ne(f)):(({load:p,pause:g,wait:d}=Atomics),g&&(d=(e,t)=>{do{g()}while(p(e,t)<1)}))}const[h,w]=t(String),y=new Map,m=K(null),b=new Proxy(m,{get(e,t){if("then"===t)return;let s=y.get(t);return s||y.set(t,s=(...e)=>{const s=((e,t)=>{let r=q;return e&&z.has(t.at(-1)||q)&&(r=t.pop(),z.delete(r)),r})(u,e),n=[f,t,i?e.map(i):e];if(c){o?ue({ID:r,data:n},s):a.postMessage(n,s),d(f,0),f[0]=0;const e=f[1]?l(f[1],f.buffer):void 0;if(e instanceof Error)throw e;return e}{const[e,t]=h();return n[0]=e,a.postMessage(n,s),t}}),s},set:G});return a.addEventListener("message",async({data:e})=>{"string"==typeof e[0]?w.apply(null,e):(await(async(e,t,r)=>{try{const s=await t[e[1]].apply(null,e[2]);e[1]=r?r(s):s,e[2]=null}catch(t){e[2]=t}})(e,m,i),a.postMessage(e))}),a.start(),{native:J,proxy:b,ffi_timeout:n,sync:c,transfer:C}};export{ge as default};
