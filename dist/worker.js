var e=Promise.withResolvers.bind(Promise),t=(t=e=>e)=>{const r=new Map;let s=0;return[()=>{let n;do{n=t(s++)}while(r.has(n));const a=e();return r.set(n,a),[n,a.promise]},(e,t,s)=>{const n=r.get(e);r.delete(e),s?n?.reject(s):n?.resolve(t)}]};let r=0;const s=r++,n=r++;r++;const a=r++,o=r++,c=r++,i=r++,l=r++,u=r++,f=r++,g=r++,p=r++,d=r++,h=r++,w=r++,y=r++,m=r++,b=r++,M=r++,S=r++,v=r++,T=r++,x=r++,B=r++,E=r++,A=r++;const L=globalThis.ImageData||class{},R=new TextDecoder;new TextEncoder,new Map(Reflect.ownKeys(Symbol).map(e=>[Symbol[e],`@${String(e)}`]));const D=Object.defineProperty,I=new ArrayBuffer(8),P=new DataView(I),U=new Uint8Array(I),$=(e,t,r)=>(e.set(t,r),r),O=e=>{U[0]=e[N++],U[1]=e[N++],U[2]=e[N++],U[3]=e[N++],U[4]=e[N++],U[5]=e[N++],U[6]=e[N++],U[7]=e[N++]},j=e=>(U[0]=e[N++],U[1]=e[N++],U[2]=e[N++],U[3]=e[N++],P.getUint32(0,!0)),k=(e,t)=>{switch(e[N++]){case o:return O(e),P.getFloat64(0,!0);case c:return e[N++];case v:{const r=$(t,N-1,{});for(let s=0,n=j(e);s<n;s++)r[k(e,t)]=k(e,t);return r}case y:{const r=$(t,N-1,[]);for(let s=0,n=j(e);s<n;s++)r.push(k(e,t));return r}case B:{const r=N-1,s=k(e,t);return $(t,r,new globalThis[s](k(e,t)))}case m:{const r=N-1,s=j(e);return $(t,r,e.slice(N,N+=s).buffer)}case h:{const r=N-1,s=j(e);return $(t,r,R.decode(e.slice(N,N+=s)))}case b:return $(t,N-1,new Date(k(e,t)));case S:{const r=$(t,N-1,new Map);for(let s=0,n=j(e);s<n;s++)r.set(k(e,t),k(e,t));return r}case x:{const r=$(t,N-1,new Set);for(let s=0,n=j(e);s<n;s++)r.add(k(e,t));return r}case M:{const r=k(e,t),s=k(e,t),n=k(e,t),a=new(globalThis[r]||Error)(s);return $(t,N-1,D(a,"stack",{value:n}))}case E:{const r=k(e,t),s=k(e,t),n=k(e,t),a=k(e,t),o=k(e,t);return $(t,N-1,new L(r,s,n,{colorSpace:a,pixelFormat:o}))}case T:{const r=k(e,t),s=k(e,t);return $(t,N-1,new RegExp(r,s))}case s:return!1;case n:return!0;case i:return NaN;case l:return 1/0;case u:return-1/0;case f:return 0;case g:return-0;case a:return null;case p:return O(e),P.getBigInt64(0,!0);case d:return O(e),P.getBigUint64(0,!0);case w:return(e=>{switch(e[0]){case"@":return Symbol[e.slice(1)];case"#":return Symbol.for(e.slice(1));case"!":return Symbol(e.slice(1));default:return Symbol()}})(k(e,t));case A:return t.get(j(e));default:return}};let N=0;const W=({byteOffset:e=0}={})=>(t,r)=>{return s=new Uint8Array(r,e,t),N=0,k(s,new Map);var s},_=[],q=new WeakSet,z=(...e)=>(q.add(e),e);let{SharedArrayBuffer:C}=globalThis,F=!0;try{new C(4,{maxByteLength:8})}catch(e){F=!1,C=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const{create:H}=Object,J=`coincident-${F?crypto.randomUUID():Math.random().toString(36).substring(2)}`,K=2*Int32Array.BYTES_PER_ELEMENT,V={byteOffset:K},X=(e,t,r)=>{const s="then"!==t;return s&&(e[t]=r),s},Y=e=>{e.stopImmediatePropagation(),e.preventDefault()},[G,Q]=t();let[Z,ee]=G(),te=()=>ee,re=()=>{},{Atomics:se,MessagePort:ne,SharedArrayBuffer:ae,postMessage:oe}=globalThis;if(F)Q(Z);else{ae=C;const e=new Map,t=(e,...t)=>{e.addEventListener(...t)};if("importScripts"in globalThis){re=t=>{e.set(t,null)};const r=t=>{const r=t[0],s=f++;return e.set(r,s),[s,r,t]},s=oe;oe=function(e,t){if(u){const n={ID:e.ID,data:r(e.data)};s(n,t)}else ee.then(()=>this.postMessage(e,t))},ne=class extends ne{postMessage(e,t){u?super.postMessage(r(e),t):ee.then(()=>this.postMessage(e,t))}},t(globalThis,"message",e=>{Y(e),Q(Z,e.data)},{once:!0});const{wait:n}=se,{parse:a}=JSON,o=t=>{const r=new XMLHttpRequest;try{if(r.timeout=3e3,r.open("POST",`${l}?sabayon`,!1),r.setRequestHeader("Content-Type","application/json"),r.send(`["${i}",${e.get(t)}]`),200===r.status)return r;throw r}catch{return r.abort(),o(t)}},c=(e,t)=>(e.set(a(t.responseText)),"ok");se={wait:(t,...r)=>e.has(t)?c(t,o(t)):n(t,...r)};let i,l,u=!1,f=Math.random();ee=ee.then(e=>{[i,l]=e,u=!0})}else{const r=[J,Math.random()].join("-").replace(/\W/g,"-"),s=new BroadcastChannel("dc78209b-186c-4f83-80e9-406becb7d9f3");s.onmessage=async t=>{const[n,a,o]=t.data;if(a===r)for(const[t,[r,a]]of e)if(r===o){await a.promise;let e=t.length;for(;e--&&!t[e];);s.postMessage([n,t.slice(0,e+1)]);break}};const{notify:n}=se;se={notify(t,...r){const s=e.get(t);return s?(s[1].resolve(),0):n(t,...r)}};let a="",o=null;const c=(e,r)=>{let s,n=!0;e.getRegistration(a).then(t=>t??e.register(a,r)).then(function r(o){const{controller:c}=e;if(n=n&&!!c,s=o.installing||o.waiting||o.active,"activated"===s.state){if(n){if(c.scriptURL===a)return Q(Z);o.unregister()}location.reload()}else t(s,"statechange",()=>r(o),{once:!0})})};te=(e,t)=>{if(!o){const r=new URL(e,location.href);a=`${r.protocol}//${r.host}${r.pathname}`,c(navigator.serviceWorker,t),o=ee}return o}}}const{setPrototypeOf:ce}=Reflect;let{postMessage:ie}=globalThis;const le=e(),ue=ne.prototype;addEventListener("message",e=>{Y(e);const[t,r,s]=e.data,[n]=e.ports;r&&(ce(n,ue),t&&(ie=oe)),le.resolve([t,r,s,n])},{once:!0});var fe=async e=>{const[r,s,n,a]=await te().then(()=>le.promise),o=!!r,c=F||!!s,i=e?.transform,l=(e?.decoder||W)(V),u=!1!==e?.transfer;let f,g,p,d;if(c){const t=new(s?ae:SharedArrayBuffer)(e?.minByteLength||32767,{maxByteLength:e?.maxByteLength||16777216});f=new Int32Array(t),s?(({wait:d}=se),re(f)):(({load:g,pause:p,wait:d}=Atomics),p&&(d=(e,t)=>{do{p()}while(g(e,t)<1)}))}const[h,w]=t(String),y=new Map,m=H(null),b=new Proxy(m,{get(e,t){if("then"===t)return;let s=y.get(t);return s||y.set(t,s=(...e)=>{const s=((e,t)=>{let r=_;return e&&q.has(t.at(-1)||_)&&(r=t.pop(),q.delete(r)),r})(u,e),n=[f,t,i?e.map(i):e];if(c){o?ie({ID:r,data:n},s):a.postMessage(n,s),d(f,0),f[0]=0;const e=f[1]?l(f[1],f.buffer):void 0;if(e instanceof Error)throw e;return e}{const[e,t]=h();return n[0]=e,a.postMessage(n,s),t}}),s},set:X});return a.addEventListener("message",async({data:e})=>{"string"==typeof e[0]?w.apply(null,e):(await(async(e,t,r)=>{try{const s=await t[e[1]].apply(null,e[2]);e[1]=r?r(s):s,e[2]=null}catch(t){e[2]=t}})(e,m,i),a.postMessage(e))}),a.start(),{native:F,proxy:b,ffi_timeout:n,sync:c,transfer:z}};export{fe as default};
