var e=Promise.withResolvers.bind(Promise),t=(t=e=>e)=>{const r=new Map;let s=0;return[()=>{let n;do{n=t(s++)}while(r.has(n));const a=e();return r.set(n,a),[n,a.promise]},(e,t,s)=>{const n=r.get(e);r.delete(e),s?n?.reject(s):n?.resolve(t)}]};let r=0;const s=r++,n=r++;r++;const a=r++,o=r++,c=r++,i=r++,l=r++,u=r++,f=r++,p=r++,g=r++,d=r++,h=r++,w=r++,y=r++,m=r++,b=r++,M=r++,S=r++,v=r++,T=r++,B=r++,x=r++,A=r++,E=r++,L=r++,R=r++;const D=globalThis.ImageData||class{},I=new TextDecoder;new TextEncoder,new Map(Reflect.ownKeys(Symbol).map(e=>[Symbol[e],`@${String(e)}`]));const P=Object.defineProperty,U=Array.isArray,$=new ArrayBuffer(8),O=new DataView($),j=new Uint8Array($),k=(e,t,r)=>(e.set(t,r),r),N=e=>{j[0]=e[_++],j[1]=e[_++],j[2]=e[_++],j[3]=e[_++],j[4]=e[_++],j[5]=e[_++],j[6]=e[_++],j[7]=e[_++]},F=e=>(j[0]=e[_++],j[1]=e[_++],j[2]=e[_++],j[3]=e[_++],O.getUint32(0,!0)),W=(e,t)=>{switch(e[_++]){case o:return N(e),O.getFloat64(0,!0);case c:return e[_++];case v:{const r=k(t,_-1,{});for(let s=0,n=F(e);s<n;s++)r[W(e,t)]=W(e,t);return r}case y:{const r=k(t,_-1,[]);for(let s=0,n=F(e);s<n;s++)r.push(W(e,t));return r}case x:{const r=_-1,s=W(e,t);return k(t,r,new globalThis[s](W(e,t)))}case m:{const r=_-1,s=F(e);return k(t,r,e.slice(_,_+=s).buffer)}case h:{const r=_-1,s=F(e);return k(t,r,I.decode(e.slice(_,_+=s)))}case b:return k(t,_-1,new Date(W(e,t)));case S:{const r=k(t,_-1,new Map);for(let s=0,n=F(e);s<n;s++)r.set(W(e,t),W(e,t));return r}case B:{const r=k(t,_-1,new Set);for(let s=0,n=F(e);s<n;s++)r.add(W(e,t));return r}case M:{const r=W(e,t),s=W(e,t),n=W(e,t),a=new(globalThis[r]||Error)(s);return k(t,_-1,P(a,"stack",{value:n}))}case A:{const r=W(e,t),s=W(e,t),n=W(e,t),a=W(e,t),o=W(e,t);return k(t,_-1,new D(r,s,n,{colorSpace:a,pixelFormat:o}))}case T:{const r=W(e,t),s=W(e,t);return k(t,_-1,new RegExp(r,s))}case s:return!1;case n:return!0;case i:return NaN;case l:return 1/0;case u:return-1/0;case f:return 0;case p:return-0;case a:return null;case g:return N(e),O.getBigInt64(0,!0);case d:return N(e),O.getBigUint64(0,!0);case w:return(e=>{switch(e[0]){case"@":return Symbol[e.slice(1)];case"#":return Symbol.for(e.slice(1));case"!":return Symbol(e.slice(1));default:return Symbol()}})(W(e,t));case R:return t.get(F(e));case E:{const r=W(e,t),s=W(e,t);return k(t,_-1,new Blob([e.slice(_,_+=s)],{type:r}))}case L:{const r=_-1,s=W(e,t),n=W(e,t),a=W(e,t);return k(t,r,new File([a],s,{type:a.type,lastModified:n}))}default:return}};let _=0;const q=({byteOffset:e=0}={})=>(t,r)=>{return s=new Uint8Array(r,e,t),_=0,W(s,new Map);var s},z=[],C=new WeakSet,H=(...e)=>(C.add(e),e);let{SharedArrayBuffer:J}=globalThis,K=!0;try{new J(4,{maxByteLength:8})}catch(e){K=!1,J=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const{create:V}=Object,X=`coincident-${K?crypto.randomUUID():Math.random().toString(36).substring(2)}`,Y=2*Int32Array.BYTES_PER_ELEMENT,G={byteOffset:Y},Q=(e,t,r)=>{const s="then"!==t;return s&&(e[t]=r),s},Z=e=>{e.stopImmediatePropagation(),e.preventDefault()},[ee,te]=t();let[re,se]=ee(),ne=()=>se,ae=()=>{},{Atomics:oe,MessagePort:ce,SharedArrayBuffer:ie,postMessage:le}=globalThis;if(K)te(re);else{ie=J;const e=new Map,t=(e,...t)=>{e.addEventListener(...t)};if("importScripts"in globalThis){ae=t=>{e.set(t,null)};const r=t=>{const r=t[0],s=f++;return e.set(r,s),[s,r,t]},s=le;le=function(e,t){if(u){const n={ID:e.ID,data:r(e.data)};s(n,t)}else se.then(()=>this.postMessage(e,t))},ce=class extends ce{postMessage(e,t){u?super.postMessage(r(e),t):se.then(()=>this.postMessage(e,t))}},t(globalThis,"message",e=>{Z(e),te(re,e.data)},{once:!0});const{wait:n}=oe,{parse:a}=JSON,o=t=>{const r=new XMLHttpRequest;try{if(r.timeout=3e3,r.open("POST",`${l}?sabayon`,!1),r.setRequestHeader("Content-Type","application/json"),r.send(`["${i}",${e.get(t)}]`),200===r.status)return r;throw r}catch{return r.abort(),o(t)}},c=(e,t)=>(e.set(a(t.responseText)),"ok");oe={wait:(t,...r)=>e.has(t)?c(t,o(t)):n(t,...r)};let i,l,u=!1,f=Math.random();se=se.then(e=>{[i,l]=e,u=!0})}else{const r=[X,Math.random()].join("-").replace(/\W/g,"-"),s=new BroadcastChannel("dc78209b-186c-4f83-80e9-406becb7d9f3");s.onmessage=async t=>{const[n,a,o]=t.data;if(a===r)for(const[t,[r,a]]of e)if(r===o){await a.promise;let e=t.length;for(;e--&&!t[e];);s.postMessage([n,t.slice(0,e+1)]);break}};const{notify:n}=oe;oe={notify(t,...r){const s=e.get(t);return s?(s[1].resolve(),0):n(t,...r)}};let a="",o=null;const c=(e,r)=>{let s,n=!0;e.getRegistration(a).then(t=>t??e.register(a,r)).then(function r(o){const{controller:c}=e;if(n=n&&!!c,s=o.installing||o.waiting||o.active,"activated"===s.state){if(n){if(c.scriptURL===a)return te(re);o.unregister()}location.reload()}else t(s,"statechange",()=>r(o),{once:!0})})};ne=(e,t)=>{if(!o){const r=new URL(e,location.href);a=`${r.protocol}//${r.host}${r.pathname}`,c(navigator.serviceWorker,t),o=se}return o}}}const{setPrototypeOf:ue}=Reflect;let{postMessage:fe}=globalThis;const pe=e(),ge=ce.prototype;addEventListener("message",e=>{Z(e);const[t,r,s]=e.data,[n]=e.ports;r&&(ue(n,ge),t&&(fe=le)),pe.resolve([t,r,s,n])},{once:!0});var de=async e=>{const[r,s,n,a]=await ne().then(()=>pe.promise),o=!!r,c=K||!!s,i=e?.transform,l=(e?.decoder||q)(G),u=!1!==e?.transfer;let f,p,g,d;if(c){const t=new(s?ie:SharedArrayBuffer)(e?.minByteLength||32767,{maxByteLength:e?.maxByteLength||16777216});f=new Int32Array(t),s?(({wait:d}=oe),ae(f)):(({load:p,pause:g,wait:d}=Atomics),g&&(d=(e,t)=>{do{g()}while(p(e,t)<1)}))}const[h,w]=t(String),y=new Map,m=V(null),b=new Proxy(m,{get(e,t){if("then"===t)return;let s=y.get(t);return s||y.set(t,s=(...e)=>{const s=((e,t)=>{let r=z;return e&&U(t.at(-1))&&C.has(t.at(-1))&&(r=t.pop(),C.delete(r)),r})(u,e),n=[f,t,i?e.map(i):e];if(c){o?fe({ID:r,data:n},s):a.postMessage(n,s),d(f,0),f[0]=0;const e=f[1]?l(f[1],f.buffer):void 0;if(e instanceof Error)throw e;return e}{const[e,t]=h();return n[0]=e,a.postMessage(n,s),t}}),s},set:Q});return a.addEventListener("message",async({data:e})=>{"string"==typeof e[0]?w.apply(null,e):(await(async(e,t,r)=>{try{const s=await t[e[1]].apply(null,e[2]);e[1]=r?r(s):s,e[2]=null}catch(t){e[2]=t}})(e,m,i),a.postMessage(e))}),a.start(),{native:K,proxy:b,ffi_timeout:n,sync:c,transfer:H}};export{de as default};
