const e="array",t="function",r="null",s="number",n="object",a="string",o="symbol",c="undefined";let i=0;const l=new Map,u=new Map,f=e=>u.get(e),p=e=>{if(!l.has(e)){let t;for(;u.has(t=i++););l.set(e,t),u.set(t,e)}return l.get(e)},{ArrayBuffer:g,Atomics:d,Promise:y}=globalThis,{isArray:w}=Array,{create:h,getPrototypeOf:v,values:m}=Object,b=v(Int32Array),M=h(d),k=()=>y.withResolvers();let E=0;const A=new Map,T=(e,t)=>class extends e{constructor(e,...r){super(e,...r),e instanceof t&&A.set(this,[E++,0,k()])}},x=new WeakSet,W=e=>(x.add(e),e),S=(e,t)=>{const{data:r}=e,s=w(r)&&(r.at(0)===t||0===r.at(1)&&!t);return s&&(e.stopImmediatePropagation(),e.preventDefault()),s},P=e=>null!==e&&"object"==typeof e&&!x.has(e),R=new WeakMap,I=(e,t,r)=>{if(A.has(e))t.set(e,A.get(e)[0]);else if(!(e instanceof b||e instanceof g))for(const s of m(e))P(s)&&!r.has(s)&&(r.add(s),I(s,t,r))},U=(...e)=>({value:new y((t=>{let r=new Worker("data:application/javascript,onmessage%3De%3D%3EpostMessage(!Atomics.wait(...e.data))");r.onmessage=()=>t("ok"),r.postMessage(e)}))}),j=(e,t,r)=>{for(const[r,s]of t)R.set(r,[s,e.currentTarget]);(({currentTarget:e,type:t,origin:r,lastEventId:s,source:n,ports:a},o)=>{e.dispatchEvent(new MessageEvent(t,{data:o,origin:r,lastEventId:s,source:n,ports:a}))})(e,r)};let{BigInt64Array:D,Int32Array:L,SharedArrayBuffer:O,Worker:B}=globalThis,$=e=>e,_=!1;const N=e=>({...e,type:"module"});try{new O(4),B=class extends B{constructor(e,t){super(e,N(t))}},M.waitAsync||(M.waitAsync=U)}catch(e){const t=crypto.randomUUID(),r=new Map,s=(e,t,r,...s)=>{e.addEventListener(t,r,...s)},n=({serviceWorker:e},n,a)=>{let o;s(e,"message",(e=>{if(S(e,t)){const[s,n,a]=e.data,c=[n,a].join(","),i=e=>{r.delete(c),o.postMessage([t,n,a,e])},l=r.get(c);if(l)i(l);else{const{promise:e,resolve:t}=k();r.set(c,t),e.then(i)}}})),e.getRegistration(n).then((t=>t??e.register(n))).then((function e(t){o=t.installing||t.waiting||t.active,"activated"===o.state?a():s(o,"statechange",(()=>e(t)),{once:!0})}))};$=W,_=!0,M.notify=(e,s)=>{const[n,a]=(e=>R.get(e))(e),o=[n,s].join(","),c=r.get(o);return c?c(e):r.set(o,e),a.postMessage([t,1,e,n,s]),0},M.waitAsync=(e,...t)=>{const[r,s]=((e,t)=>{const r=A.get(e),[s,n,{promise:a}]=r;return r[1]=t,[s,a]})(e,...t);return{value:s}},O=class extends g{},D=T(D,O),L=T(L,O);let a=null;B=class extends B{constructor(e,r){let o=r?.serviceWorker||"";if(o){if(o=new URL(o,location.href).href,r={...r,serviceWorker:o},!a){const{promise:e,resolve:t}=k();n(navigator,o,t),a=e}a.then((()=>super.postMessage([t,3])))}super(e,N(r)),super.postMessage([t,0,r]),s(this,"message",(e=>{if(S(e,t)){const[t,r,...s]=e.data;switch(r){case 1:((e,t,r)=>{for(const[s,[n,a,{resolve:o}]]of A)if(t===n&&r===a){for(let t=0;t<e.length;t++)s[t]=e[t];A.delete(s),o("ok");break}})(...s);break;case 2:j(e,...s)}}}))}postMessage(e,...r){return super.postMessage(((e,t)=>{const r=new Map;return P(t)&&I(t,r,new Set),r.size?[e,2,r,t]:t})(t,e),...r)}}}const{BYTES_PER_ELEMENT:z}=Int32Array,{BYTES_PER_ELEMENT:F}=Uint16Array,{notify:Y}=M,C=new TextDecoder("utf-16"),H=new WeakSet,J=(...e)=>(H.add(e),e);let K="";const q=new Map;let G=0;const Q=([e,t,r,s,n,a,o,c,i,l],u)=>(...f)=>{let p=""!==K,g=0;p&&(g=((e,t)=>setTimeout(console.warn,1e3,`ðŸ’€ðŸ”’ - proxy.${e}() in proxy.${t}()`))(u,K));const d=G++,y=[];H.has(f.at(-1)||y)&&H.delete(y=f.pop());const w=s(i?f.map(i):f);let h=new t(new r(2*z));return c([e,2,u,d,h,w,n],{transfer:y}),l(h,0).value.then((()=>{p&&clearTimeout(g);const s=h[1];if(!s)return;const n=F*s;return h=new t(new r(n+n%z)),c([e,1,d,h]),l(h,0).value.then((()=>{const e=new Uint16Array(h.buffer),t=o?e.subarray(0,s):e.slice(0,s);return a(C.decode(t))}))}))};var V=({parse:e,stringify:t,transform:r}=JSON)=>{const s=((e,t)=>async(r,[s,n,a,o,c])=>{c&&(K=s);try{const s=await r(...o);if(void 0!==s){const r=e(t?t(s):s);q.set(n,r),a[1]=r.length}}finally{c&&(K=""),a[0]=1,Y(a,0)}})(t,r),n=crypto.randomUUID();return{Worker:class extends B{constructor(t,a){const o=new Map;super(t,a),this.proxy=((e,t)=>new Proxy(t,{get:(t,r)=>t.get(r)||t.set(r,Q(e,r)).get(r),set:(e,t,r)=>!!e.set(t,r)}))([n,L,O,$,!1,e,_,(...e)=>this.postMessage(...e),r,M.waitAsync],o),this.postMessage($([n,0,a])),this.addEventListener("message",(e=>{if(S(e,n)){const[t,r,...n]=e.data;switch(r){case 2:((e,t,r)=>{const[s]=r,n=t.get(s);if(!n)throw new Error(`Unknown proxy.${s}()`);e(n,r)})(s,o,n);break;case 1:((e,t)=>{const r=q.get(e);q.delete(e);for(let e=new Uint16Array(t.buffer),s=0,{length:n}=r;s<n;s++)e[s]=r.charCodeAt(s);Y(t,0)})(...n)}}}))}},polyfill:_,transfer:J}},X=Object.fromEntries([e,"bigint","boolean",t,r,s,n,a,o,c].map(((e,t)=>[e,t])));const Z="ownKeys",ee="destruct",{[Z]:te}=Reflect,re=new Map(te(Symbol).filter((e=>typeof Symbol[e]===o)).map((e=>[Symbol[e],e]))),se=e=>re.get(e)||`.${Symbol.keyFor(e)||""}`,ne="029d89be-c1c3-4993-a5e4-1b211947c69e",ae="M"+ne,oe="W"+ne,ce=new FinalizationRegistry((([e,t,r])=>{r&&console.debug(`Held value ${String(t)} not relevant anymore`),e(t)})),ie=Object.create(null),{addEventListener:le}=EventTarget.prototype,ue=new WeakMap;Reflect.defineProperty(EventTarget.prototype,"addEventListener",{value(e,t,...r){const s=r.at(0)?.invoke;if(s){let t=ue.get(this);t||ue.set(this,t=new Map),t.set(e,[].concat(s)),delete r[0].invoke}return le.call(this,e,t,...r)}});const{isArray:fe}=Array;var pe=i=>{const g=V(i),{Worker:d}=g,y=s=>{const a=typeof s;switch(a){case n:return null===s?[X[r],s]:s===globalThis?[X[n],null]:fe(s)?[X[e],p(s)]:[X[n],s instanceof b?s:p(s)];case t:return[X[t],p(s)];case o:return[X[o],se(s)];default:return[X[a],s]}};return{...g,Worker:class extends d{constructor(r,i){const{proxy:p}=super(r,i),{[oe]:g}=p,d=new Map,w=e=>{d.delete(e),g(ee,e)},h=([r,c])=>{switch(r){case X[n]:if(null===c)return globalThis;if(typeof c===s)return f(c);if(!(c instanceof b))for(const e in c)c[e]=h(c[e]);return c;case X[e]:return typeof c===s?f(c):c.map(h);case X[t]:switch(typeof c){case s:return f(c);case a:{let e=d.get(c)?.deref();return e||(e=((e,t,{debug:r,handler:s,return:n,token:a=e}=ie)=>{const o=n||new Proxy(e,s||ie),c=[o,[t,e,!!r]];return!1!==a&&c.push(a),ce.register(...c),o})(c,w,{token:!1,return:function(...e){return e.at(0)instanceof Event&&(e=>{const{currentTarget:t,target:r,type:s}=e,n=ue.get(t||r)?.get(s);if(n)for(const t of n)e[t]()})(...e),g("apply",c,y(this),e.map(y)).then(h)}}),d.set(c,new WeakRef(e))),e}}case X[o]:return(e=>{if(e.startsWith("."))return Symbol.for(e.slice(1));for(const[t,r]of re)if(r===e)return t})(c);default:return c}},v=(e,t)=>{const{get:r,set:s,value:n}=e;return r&&(e.get=t(r)),s&&(e.set=t(s)),n&&(e.value=t(n)),e};p[ae]=(t,r,...a)=>{if(t===ee)(e=>{const[t,r]=typeof e===s?[u,l]:[l,u],n=t.has(e);n&&(r.delete(t.get(e)),t.delete(e))})(r);else{const s=Reflect[t],o=null==r?globalThis:f(r);switch(t){case"defineProperty":{const[e,t]=a.map(h);return y(s(o,e,t))}case"getOwnPropertyDescriptor":{const e=s(o,...a.map(h));return[X[e?n:c],e&&v(e,y)]}case Z:return[X[e],s(o).map(y)];default:return((e,t,r)=>y(e(t,...r.map(h))))(s,o,a)}}}}}}};export{pe as default};
