const e="b3e5cb6e",t="="+e,r="-"+e;let s=0;const n=s++,o=s++;s++;const a=s++,i=s++,c=s++,l=s++,u=s++,f=s++,p=s++,h=s++,g=s++,y=s++,d=s++,w=s++,b=s++,m=s++,v=s++,M=s++,$=s++,x=s++,S=s++,P=s++,A=s++,B=s++,T=s++,O=s++,k=s++;const E=globalThis.ImageData||class{},L=new TextDecoder;new TextEncoder;const R=new Map(Reflect.ownKeys(Symbol).map(e=>[Symbol[e],`@${String(e)}`])),U=e=>{switch(e[0]){case"@":return Symbol[e.slice(1)];case"#":return Symbol.for(e.slice(1));case"!":return Symbol(e.slice(1));default:return Symbol()}},j=e=>R.get(e)||((e,t)=>void 0===t?"?":void 0===Symbol.keyFor(e)?`!${t}`:`#${t}`)(e,e.description),D=Object.defineProperty,I=Object.assign,_=Array.isArray,W=ArrayBuffer.isView,q=(e,t)=>[e,t],F=e=>e,K=[],N={},z=function(){},C=e=>(t,r=new Map)=>{for(let s=0,n=t.length;s<n;s++)t[s]=e(t[s],r);return t},H=([e,t])=>0===e?t:U(t),V=e=>"string"==typeof e?q(0,e):q(16,j(e)),J=new ArrayBuffer(8),X=new DataView(J),Y=new Uint8Array(J),G=(e,t,r)=>(e.set(t,r),r),Q=e=>{Y[0]=e[te++],Y[1]=e[te++],Y[2]=e[te++],Y[3]=e[te++],Y[4]=e[te++],Y[5]=e[te++],Y[6]=e[te++],Y[7]=e[te++]},Z=e=>(Y[0]=e[te++],Y[1]=e[te++],Y[2]=e[te++],Y[3]=e[te++],X.getUint32(0,!0)),ee=(e,t)=>{switch(e[te++]){case i:return Q(e),X.getFloat64(0,!0);case c:return e[te++];case x:{const r=G(t,te-1,{});for(let s=0,n=Z(e);s<n;s++)r[ee(e,t)]=ee(e,t);return r}case b:{const r=G(t,te-1,[]);for(let s=0,n=Z(e);s<n;s++)r.push(ee(e,t));return r}case A:{const r=te-1,s=ee(e,t);return G(t,r,new globalThis[s](ee(e,t)))}case m:{const r=te-1,s=Z(e);return G(t,r,e.slice(te,te+=s).buffer)}case d:{const r=te-1,s=Z(e);return G(t,r,L.decode(e.slice(te,te+=s)))}case v:return G(t,te-1,new Date(ee(e,t)));case $:{const r=G(t,te-1,new Map);for(let s=0,n=Z(e);s<n;s++)r.set(ee(e,t),ee(e,t));return r}case P:{const r=G(t,te-1,new Set);for(let s=0,n=Z(e);s<n;s++)r.add(ee(e,t));return r}case M:{const r=ee(e,t),s=ee(e,t),n=ee(e,t),o=new(globalThis[r]||Error)(s);return G(t,te-1,D(o,"stack",{value:n}))}case B:{const r=ee(e,t),s=ee(e,t),n=ee(e,t),o=ee(e,t),a=ee(e,t);return G(t,te-1,new E(r,s,n,{colorSpace:o,pixelFormat:a}))}case S:{const r=ee(e,t),s=ee(e,t);return G(t,te-1,new RegExp(r,s))}case n:return!1;case o:return!0;case l:return NaN;case u:return 1/0;case f:return-1/0;case p:return 0;case h:return-0;case a:return null;case g:return Q(e),X.getBigInt64(0,!0);case y:return Q(e),X.getBigUint64(0,!0);case w:return U(ee(e,t));case k:return t.get(Z(e));case T:{const r=ee(e,t),s=ee(e,t);return G(t,te-1,new Blob([e.slice(te,te+=s)],{type:r}))}case O:{const r=te-1,s=ee(e,t),n=ee(e,t),o=ee(e,t);return G(t,r,new File([o],s,{type:o.type,lastModified:n}))}default:return}};let te=0;const re=({byteOffset:e=0}={})=>(t,r)=>{return s=new Uint8Array(r,e,t),te=0,ee(s,new Map);var s};let se=0;const ne=se++,oe=se++,ae=se++,ie=se++,ce=se++,le=se++,ue=se++,fe=se++,pe=se++,he=se++,ge=se++,ye=se++,de=se++,we=se++,be=se++;se++;const me=se++,ve=se++,{getPrototypeOf:Me}=Object,{toString:$e}=N,xe=(e,t=$e.call(e).slice(8,-1))=>t in globalThis?t:xe(Me(e)||N),Se=(e,t)=>new ArrayBuffer(e,{maxByteLength:t}),Pe=([e,t],r)=>{const s=r?e.byteLength:e.length;if(r){if(t){const r=Se(s,t);new Uint8Array(r).set(new Uint8Array(e)),e=r}}else{const r=t?Se(s,t):new ArrayBuffer(s);new Uint8Array(r).set(e),e=r}return e};const Ae=/\[('|")?(.+?)\1\]/g,Be=(e,t)=>e?.[t];var Te=e=>{const t=[],r=e=>{const r=t.splice(e);for(;e<r.length;)r[e++].delete(r[e++])};return class s extends Map{static keys=Symbol();static proto=Symbol();drop(e,t){return e!==s.proto&&super.delete(s.keys),super.delete(e),t}set(s,n){return((s,n)=>{t.push(s,n)<3&&setTimeout(r,e,0)})(super.set(s,n),s),n}}},Oe=({reflect:e=F,transform:t=F,released:r=F,buffer:s=!1,timeout:n=-1}=N)=>{const o=C(H),a=C(V),i=e=>{if(!_(e))return e;const[t,r]=e;if(1&t)return u(t,r);switch(t){case 2:return A;case 0:return r;case 16:return U(r);case 32:return BigInt(r);case 68:return(([e,t,r,s],n)=>{const o=Pe(t,n),a=globalThis[e];return s?new a(o,r,s):new a(o,r)})(r,s);case 64:return Pe(r,s)}},c=(e,r=new Map)=>{switch(typeof e){case"object":{if(null===e)break;if(e===globalThis)return P;if(S in e)return w;let s=r.get(e);if(!s){const n=t(e);if(b||!d.has(n)){if(_(n)){const t=[];s=q(4,t),r.set(e,s);for(let e=0,s=n.length;e<s;e++)t[e]=c(n[e],r);return s}if(!(W(n)||n instanceof ArrayBuffer||"Object"!==xe(n))){const t={};s=q(2,t),r.set(e,s);for(const e in n)t[e]=c(n[e],r);return s}}s=q(0,n),r.set(e,s)}return s}case"function":{if(S in e)return w;let s=r.get(e);if(!s){const n=t(e);s=q(8,v(n)),r.set(e,s)}return s}case"symbol":return q(16,j(e))}return e},l=C(c),u=(e,t)=>{let r=x.get(t),s=r?.deref();return s||(r&&B.unregister(r),s=9===e?new Proxy(z,new y(e,t)):new Proxy(3===e?N:K,new g(e,t)),r=new WeakRef(s),x.set(t,r),B.register(s,t,r)),s},f=e=>{switch(typeof e){case"object":if(null===e)break;case"function":return S in e}return!1},p=-1<n,h=p?Te(n):Map;class g{constructor(e,t){this.t=e,this.v=t,p&&(this.$=new h)}get(t,r){if(p&&this.$.has(r))return this.$.get(r);const s=e(he,this.v,V(r));return p?s[0]?this.$.set(r,i(s[1])):i(s[1]):i(s)}set(t,r,s){const n=e(me,this.v,V(r),c(s));return p?this.$.drop(r,n):n}has(t,r){return r===S?(w=[this.t,this.v],!0):e(de,this.v,V(r))}_oK(){return o(e(be,this.v),x)}ownKeys(e){return p?this.$.has(h.keys)?this.$.get(h.keys):this.$.set(h.keys,this._oK()):this._oK()}getOwnPropertyDescriptor(t,r){const s=i(e(ge,this.v,V(r)));if(s)for(const e in s)s[e]=i(s[e]);return s}defineProperty(t,r,s){const n=e(fe,this.v,V(r),c(s));return p?this.$.drop(r,n):n}deleteProperty(t,r){const s=e(pe,this.v,V(r));return p?this.$.drop(r,s):s}_gPO(){return i(e(ye,this.v))}getPrototypeOf(e){return p?this.$.has(h.proto)?this.$.get(h.proto):this.$.set(h.proto,this._gPO()):this._gPO()}setPrototypeOf(t,r){const s=e(ve,this.v,c(r));return p?this.$.drop(h.proto,s):s}isExtensible(t){return e(we,this.v)}preventExtensions(e){return!1}}class y extends g{construct(t,r){return i(e(ue,this.v,l(r)))}apply(t,r,s){const n=new Map;return i(e(le,this.v,c(r,n),l(s,n)))}get(e,t){switch(t){case"apply":return(t,r)=>this.apply(e,t,r);case"call":return(t,...r)=>this.apply(e,t,r);default:return super.get(e,t)}}}let d,w,b=!0;const{apply:m}=Reflect,{id:v,ref:M,unref:$}=((e=0,t=new Map,r=new Map)=>({clear:()=>{t.clear(),r.clear()},id:s=>{let n=r.get(s);if(void 0===n){for(;t.has(n=e++););t.set(n,s),r.set(s,n)}return n},ref:e=>t.get(e),unref:e=>(r.delete(t.get(e)),t.delete(e))}))(),x=new Map,S=Symbol("reflected-ffi"),P=q(2,null),A=new Proxy(N,new g(2,null)),B=new FinalizationRegistry(t=>{x.delete(t),e(ne,t)});return{global:A,isProxy:f,assign(t,...r){const s=f(t),n=I(s?{}:t,...r);return s&&e(oe,w[1],c(n)),t},direct:e=>(b&&(b=!1,d=new WeakSet),d.add(e),e),evaluate:(t,...r)=>i(e(ae,null,function(e=this){return String(e).replace(/^(async\s*)?(\bfunction\b)?(.*?)\(/,(e,t,r,s)=>s&&!r?`${t||""}function ${s}(`:e)}(t),l(r))),gather(t,...r){const s=f(t),n=s?i:e=>t[e];s&&(r=e(ie,w[1],a(r,x)));for(let e=0;e<r.length;e++)r[e]=n(r[e]);return r},query:(t,r)=>f(t)?i(e(ce,w[1],r)):((e,t)=>t.replace(Ae,".$2").split(".").reduce(Be,e))(t,r),reflect:async(e,t,...s)=>{switch(e){case le:{const[e,r]=s;for(let e=0,t=r.length;e<t;e++)r[e]=i(r[e]);return c(await m(M(t),i(e),r))}case ne:return r(M(t)),$(t)}}}};var ke=Promise.withResolvers.bind(Promise),Ee=(e=e=>e)=>{const t=new Map;let r=0;return[()=>{let s;do{s=e(r++)}while(t.has(s));const n=ke();return t.set(s,n),[s,n.promise]},(e,r,s)=>{const n=t.get(e);t.delete(e),s?n?.reject(s):n?.resolve(r)}]};const Le=[],Re=new WeakSet,Ue=(...e)=>(Re.add(e),e);let{SharedArrayBuffer:je}=globalThis,De=!0;try{new je(4,{maxByteLength:8})}catch(e){De=!1,je=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const{create:Ie}=Object,_e=`coincident-${De?crypto.randomUUID():Math.random().toString(36).substring(2)}`,We=2*Int32Array.BYTES_PER_ELEMENT,qe={byteOffset:We},Fe=(e,t,r)=>{const s="then"!==t;return s&&(e[t]=r),s},Ke=e=>{e.stopImmediatePropagation(),e.preventDefault()},[Ne,ze]=Ee();let[Ce,He]=Ne(),Ve=()=>He,Je=()=>{},{Atomics:Xe,MessagePort:Ye,SharedArrayBuffer:Ge,postMessage:Qe}=globalThis;if(De)ze(Ce);else{Ge=je;const e=new Map,t=(e,...t)=>{e.addEventListener(...t)};if("importScripts"in globalThis){Je=t=>{e.set(t,null)};const r=t=>{const r=t[0],s=f++;return e.set(r,s),[s,r,t]},s=Qe;Qe=function(e,t){if(u){const n={ID:e.ID,data:r(e.data)};s(n,t)}else He.then(()=>this.postMessage(e,t))},Ye=class extends Ye{postMessage(e,t){u?super.postMessage(r(e),t):He.then(()=>this.postMessage(e,t))}},t(globalThis,"message",e=>{Ke(e),ze(Ce,e.data)},{once:!0});const{wait:n}=Xe,{parse:o}=JSON,a=t=>{const r=new XMLHttpRequest;try{if(r.timeout=3e3,r.open("POST",`${l}?sabayon`,!1),r.setRequestHeader("Content-Type","application/json"),r.send(`["${c}",${e.get(t)}]`),200===r.status)return r;throw r}catch{return r.abort(),a(t)}},i=(e,t)=>(e.set(o(t.responseText)),"ok");Xe={wait:(t,...r)=>e.has(t)?i(t,a(t)):n(t,...r)};let c,l,u=!1,f=Math.random();He=He.then(e=>{[c,l]=e,u=!0})}else{const r=[_e,Math.random()].join("-").replace(/\W/g,"-"),s=new BroadcastChannel("dc78209b-186c-4f83-80e9-406becb7d9f3");s.onmessage=async t=>{const[n,o,a]=t.data;if(o===r)for(const[t,[r,o]]of e)if(r===a){await o.promise;let e=t.length;for(;e--&&!t[e];);s.postMessage([n,t.slice(0,e+1)]);break}};const{notify:n}=Xe;Xe={notify(t,...r){const s=e.get(t);return s?(s[1].resolve(),0):n(t,...r)}};let o="",a=null;const i=(e,r)=>{let s,n=!0;e.getRegistration(o).then(t=>t??e.register(o,r)).then(function r(a){const{controller:i}=e;if(n=n&&!!i,s=a.installing||a.waiting||a.active,"activated"===s.state){if(n){if(i.scriptURL===o)return ze(Ce);a.unregister()}location.reload()}else t(s,"statechange",()=>r(a),{once:!0})})};Ve=(e,t)=>{if(!a){const r=new URL(e,location.href);o=`${r.protocol}//${r.host}${r.pathname}`,i(navigator.serviceWorker,t),a=He}return a}}}const{setPrototypeOf:Ze}=Reflect;let{postMessage:et}=globalThis;const tt=ke(),rt=Ye.prototype;addEventListener("message",e=>{Ke(e);const[t,r,s]=e.data,[n]=e.ports;r&&(Ze(n,rt),t&&(et=Qe)),tt.resolve([t,r,s,n])},{once:!0});var st=async e=>{const[t,r,s,n]=await Ve().then(()=>tt.promise),o=!!t,a=De||!!r,i=e?.transform,c=(e?.decoder||re)(qe),l=!1!==e?.transfer;let u,f,p,h;if(a){const t=new(r?Ge:SharedArrayBuffer)(e?.minByteLength||32767,{maxByteLength:e?.maxByteLength||16777216});u=new Int32Array(t),r?(({wait:h}=Xe),Je(u)):(({load:f,pause:p,wait:h}=Atomics),p&&(h=(e,t)=>{do{p()}while(f(e,t)<1)}))}const[g,y]=Ee(String),d=new Map,w=Ie(null),b=new Proxy(w,{get(e,r){if("then"===r)return;let s=d.get(r);return s||d.set(r,s=(...e)=>{const s=((e,t)=>{let r=Le;return e&&Re.has(t.at(-1)||Le)&&(r=t.pop(),Re.delete(r)),r})(l,e),f=[u,r,i?e.map(i):e];if(a){o?et({ID:t,data:f},s):n.postMessage(f,s),h(u,0),u[0]=0;const e=u[1]?c(u[1],u.buffer):void 0;if(e instanceof Error)throw e;return e}{const[e,t]=g();return f[0]=e,n.postMessage(f,s),t}}),s},set:Fe});return n.addEventListener("message",async({data:e})=>{"string"==typeof e[0]?y.apply(null,e):(await(async(e,t,r)=>{try{const s=await t[e[1]].apply(null,e[2]);e[1]=r?r(s):s,e[2]=null}catch(t){e[2]=t}})(e,w,i),n.postMessage(e))}),n.start(),{native:De,proxy:b,ffi_timeout:s,sync:a,transfer:Ue}},nt=async e=>{const s=await st({...e,decoder:e?.decoder||re}),n=Oe({...e,buffer:!0,reflect:s.proxy[t],timeout:s.ffi_timeout});return s.proxy[r]=n.reflect,{...s,window:n.global,isWindowProxy:n.isProxy,ffi:{assign:n.assign,direct:n.direct,evaluate:n.evaluate,gather:n.gather,query:n.query}}};export{nt as default};
