const e="dbf1617e",t="="+e,r="-"+e;let n=0;const s=n++,a=n++;n++;const o=n++,i=n++,c=n++,l=n++,u=n++,f=n++,h=n++,p=n++,g=n++,y=n++,d=n++,w=n++,b=n++,m=n++,v=n++,M=n++,$=n++,x=n++,S=n++,P=n++,A=n++,B=n++,T=n++;const O=globalThis.ImageData||class{},k=new TextDecoder;new TextEncoder;const E=new Map(Reflect.ownKeys(Symbol).map(e=>[Symbol[e],`@${String(e)}`])),L=e=>{switch(e[0]){case"@":return Symbol[e.slice(1)];case"#":return Symbol.for(e.slice(1));case"!":return Symbol(e.slice(1));default:return Symbol()}},R=e=>E.get(e)||((e,t)=>void 0===t?"?":void 0===Symbol.keyFor(e)?`!${t}`:`#${t}`)(e,e.description),U=Object.defineProperty,j=Object.assign,D=Array.isArray,I=ArrayBuffer.isView,_=(e,t)=>[e,t],W=e=>e,q=[],K={},F=function(){},N=e=>(t,r=new Map)=>{for(let n=0,s=t.length;n<s;n++)t[n]=e(t[n],r);return t},z=([e,t])=>0===e?t:L(t),C=e=>"string"==typeof e?_(0,e):_(16,R(e)),H=new ArrayBuffer(8),V=new DataView(H),J=new Uint8Array(H),X=(e,t,r)=>(e.set(t,r),r),Y=e=>{J[0]=e[Z++],J[1]=e[Z++],J[2]=e[Z++],J[3]=e[Z++],J[4]=e[Z++],J[5]=e[Z++],J[6]=e[Z++],J[7]=e[Z++]},G=e=>(J[0]=e[Z++],J[1]=e[Z++],J[2]=e[Z++],J[3]=e[Z++],V.getUint32(0,!0)),Q=(e,t)=>{switch(e[Z++]){case i:return Y(e),V.getFloat64(0,!0);case c:return e[Z++];case x:{const r=X(t,Z-1,{});for(let n=0,s=G(e);n<s;n++)r[Q(e,t)]=Q(e,t);return r}case b:{const r=X(t,Z-1,[]);for(let n=0,s=G(e);n<s;n++)r.push(Q(e,t));return r}case A:{const r=Z-1,n=Q(e,t);return X(t,r,new globalThis[n](Q(e,t)))}case m:{const r=Z-1,n=G(e);return X(t,r,e.slice(Z,Z+=n).buffer)}case d:{const r=Z-1,n=G(e);return X(t,r,k.decode(e.slice(Z,Z+=n)))}case v:return X(t,Z-1,new Date(Q(e,t)));case $:{const r=X(t,Z-1,new Map);for(let n=0,s=G(e);n<s;n++)r.set(Q(e,t),Q(e,t));return r}case P:{const r=X(t,Z-1,new Set);for(let n=0,s=G(e);n<s;n++)r.add(Q(e,t));return r}case M:{const r=Q(e,t),n=Q(e,t),s=Q(e,t),a=new(globalThis[r]||Error)(n);return X(t,Z-1,U(a,"stack",{value:s}))}case B:{const r=Q(e,t),n=Q(e,t),s=Q(e,t),a=Q(e,t),o=Q(e,t);return X(t,Z-1,new O(r,n,s,{colorSpace:a,pixelFormat:o}))}case S:{const r=Q(e,t),n=Q(e,t);return X(t,Z-1,new RegExp(r,n))}case s:return!1;case a:return!0;case l:return NaN;case u:return 1/0;case f:return-1/0;case h:return 0;case p:return-0;case o:return null;case g:return Y(e),V.getBigInt64(0,!0);case y:return Y(e),V.getBigUint64(0,!0);case w:return L(Q(e,t));case T:return t.get(G(e));default:return}};let Z=0;const ee=({byteOffset:e=0}={})=>(t,r)=>{return n=new Uint8Array(r,e,t),Z=0,Q(n,new Map);var n};let te=0;const re=te++,ne=te++,se=te++,ae=te++,oe=te++,ie=te++,ce=te++,le=te++,ue=te++,fe=te++,he=te++,pe=te++,ge=te++,ye=te++,de=te++;te++;const we=te++,be=te++,{getPrototypeOf:me}=Object,{toString:ve}=K,Me=(e,t=ve.call(e).slice(8,-1))=>t in globalThis?t:Me(me(e)||K),$e=(e,t)=>new ArrayBuffer(e,{maxByteLength:t}),xe=([e,t],r)=>{const n=r?e.byteLength:e.length;if(r){if(t){const r=$e(n,t);new Uint8Array(r).set(new Uint8Array(e)),e=r}}else{const r=t?$e(n,t):new ArrayBuffer(n);new Uint8Array(r).set(e),e=r}return e};const Se=/\[('|")?(.+?)\1\]/g,Pe=(e,t)=>e?.[t];var Ae=e=>{const t=[],r=e=>{const r=t.splice(e);for(;e<r.length;)r[e++].delete(r[e++])};return class n extends Map{static keys=Symbol();static proto=Symbol();drop(e,t){return e!==n.proto&&super.delete(n.keys),super.delete(e),t}set(n,s){return((n,s)=>{t.push(n,s)<3&&setTimeout(r,e,0)})(super.set(n,s),n),s}}},Be=({reflect:e=W,transform:t=W,released:r=W,buffer:n=!1,timeout:s=-1}=K)=>{const a=N(z),o=N(C),i=e=>{if(!D(e))return e;const[t,r]=e;if(1&t)return u(t,r);switch(t){case 2:return A;case 0:return r;case 16:return L(r);case 32:return BigInt(r);case 68:return(([e,t,r,n],s)=>{const a=xe(t,s),o=globalThis[e];return n?new o(a,r,n):new o(a,r)})(r,n);case 64:return xe(r,n)}},c=(e,r=new Map)=>{switch(typeof e){case"object":{if(null===e)break;if(e===globalThis)return P;if(S in e)return w;let n=r.get(e);if(!n){const s=t(e);if(b||!d.has(s)){if(D(s)){const t=[];n=_(4,t),r.set(e,n);for(let e=0,n=s.length;e<n;e++)t[e]=c(s[e],r);return n}if(!(I(s)||s instanceof ArrayBuffer||"Object"!==Me(s))){const t={};n=_(2,t),r.set(e,n);try{for(const e in s)break}catch{return n}for(const e in s)t[e]=c(s[e],r);return n}}n=_(0,s),r.set(e,n)}return n}case"function":{if(S in e)return w;let n=r.get(e);if(!n){const s=t(e);n=_(8,v(s)),r.set(e,n)}return n}case"symbol":return _(16,R(e))}return e},l=N(c),u=(e,t)=>{let r=x.get(t),n=r?.deref();return n||(r&&B.unregister(r),n=9===e?new Proxy(F,new y(e,t)):new Proxy(3===e?K:q,new g(e,t)),r=new WeakRef(n),x.set(t,r),B.register(n,t,r)),n},f=e=>{switch(typeof e){case"object":if(null===e)break;case"function":return S in e}return!1},h=-1<s,p=h?Ae(s):Map;class g{constructor(e,t){this.t=e,this.v=t,h&&(this.$=new p)}get(t,r){if(h&&this.$.has(r))return this.$.get(r);const n=e(fe,this.v,C(r));return h?n[0]?this.$.set(r,i(n[1])):i(n[1]):i(n)}set(t,r,n){const s=e(we,this.v,C(r),c(n));return h?this.$.drop(r,s):s}has(t,r){return r===S?(w=[this.t,this.v],!0):e(ge,this.v,C(r))}_oK(){return a(e(de,this.v),x)}ownKeys(e){return h?this.$.has(p.keys)?this.$.get(p.keys):this.$.set(p.keys,this._oK()):this._oK()}getOwnPropertyDescriptor(t,r){const n=i(e(he,this.v,C(r)));if(n)for(const e in n)n[e]=i(n[e]);return n}defineProperty(t,r,n){const s=e(le,this.v,C(r),c(n));return h?this.$.drop(r,s):s}deleteProperty(t,r){const n=e(ue,this.v,C(r));return h?this.$.drop(r,n):n}_gPO(){return i(e(pe,this.v))}getPrototypeOf(e){return h?this.$.has(p.proto)?this.$.get(p.proto):this.$.set(p.proto,this._gPO()):this._gPO()}setPrototypeOf(t,r){const n=e(be,this.v,c(r));return h?this.$.drop(p.proto,n):n}isExtensible(t){return e(ye,this.v)}preventExtensions(e){return!1}}class y extends g{construct(t,r){return i(e(ce,this.v,l(r)))}apply(t,r,n){const s=new Map;return i(e(ie,this.v,c(r,s),l(n,s)))}get(e,t){switch(t){case"apply":return(t,r)=>this.apply(e,t,r);case"call":return(t,...r)=>this.apply(e,t,r);default:return super.get(e,t)}}}let d,w,b=!0;const{apply:m}=Reflect,{id:v,ref:M,unref:$}=((e=0,t=new Map,r=new Map)=>({clear:()=>{t.clear(),r.clear()},id:n=>{let s=r.get(n);if(void 0===s){for(;t.has(s=e++););t.set(s,n),r.set(n,s)}return s},ref:e=>t.get(e),unref:e=>(r.delete(t.get(e)),t.delete(e))}))(),x=new Map,S=Symbol("reflected-ffi"),P=_(2,null),A=new Proxy(K,new g(2,null)),B=new FinalizationRegistry(t=>{x.delete(t),e(re,t)});return{global:A,isProxy:f,assign(t,...r){const n=f(t),s=j(n?{}:t,...r);return n&&e(ne,w[1],c(s)),t},direct:e=>(b&&(b=!1,d=new WeakSet),d.add(e),e),evaluate:(t,...r)=>i(e(se,null,function(e=this){return String(e).replace(/^(async\s*)?(\bfunction\b)?(.*?)\(/,(e,t,r,n)=>n&&!r?`${t||""}function ${n}(`:e)}(t),l(r))),gather(t,...r){const n=f(t),s=n?i:e=>t[e];n&&(r=e(ae,w[1],o(r,x)));for(let e=0;e<r.length;e++)r[e]=s(r[e]);return r},query:(t,r)=>f(t)?i(e(oe,w[1],r)):((e,t)=>t.replace(Se,".$2").split(".").reduce(Pe,e))(t,r),reflect:async(e,t,...n)=>{switch(e){case ie:{const[e,r]=n;for(let e=0,t=r.length;e<t;e++)r[e]=i(r[e]);return c(await m(M(t),i(e),r))}case re:return r(M(t)),$(t)}}}};var Te=Promise.withResolvers.bind(Promise),Oe=(e=e=>e)=>{const t=new Map;let r=0;return[()=>{let n;do{n=e(r++)}while(t.has(n));const s=Te();return t.set(n,s),[n,s.promise]},(e,r,n)=>{const s=t.get(e);t.delete(e),n?s?.reject(n):s?.resolve(r)}]};const ke=[],Ee=new WeakSet,Le=(...e)=>(Ee.add(e),e);let{SharedArrayBuffer:Re}=globalThis,Ue=!0;try{new Re(4,{maxByteLength:8})}catch(e){Ue=!1,Re=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const{create:je}=Object,De=`coincident-${Ue?crypto.randomUUID():Math.random().toString(36).substring(2)}`,Ie=2*Int32Array.BYTES_PER_ELEMENT,_e={byteOffset:Ie},We=(e,t,r)=>{const n="then"!==t;return n&&(e[t]=r),n},qe=e=>{e.stopImmediatePropagation(),e.preventDefault()},[Ke,Fe]=Oe();let[Ne,ze]=Ke(),Ce=()=>ze,He=()=>{},{Atomics:Ve,MessagePort:Je,SharedArrayBuffer:Xe,postMessage:Ye}=globalThis;if(Ue)Fe(Ne);else{Xe=Re;const e=new Map,t=(e,...t)=>{e.addEventListener(...t)};if("importScripts"in globalThis){He=t=>{e.set(t,null)};const r=t=>{const r=t[0],n=f++;return e.set(r,n),[n,r,t]},n=Ye;Ye=function(e,t){if(u){const s={ID:e.ID,data:r(e.data)};n(s,t)}else ze.then(()=>this.postMessage(e,t))},Je=class extends Je{postMessage(e,t){u?super.postMessage(r(e),t):ze.then(()=>this.postMessage(e,t))}},t(globalThis,"message",e=>{qe(e),Fe(Ne,e.data)},{once:!0});const{wait:s}=Ve,{parse:a}=JSON,o=t=>{const r=new XMLHttpRequest;try{if(r.timeout=3e3,r.open("POST",`${l}?sabayon`,!1),r.setRequestHeader("Content-Type","application/json"),r.send(`["${c}",${e.get(t)}]`),200===r.status)return r;throw r}catch{return r.abort(),o(t)}},i=(e,t)=>(e.set(a(t.responseText)),"ok");Ve={wait:(t,...r)=>e.has(t)?i(t,o(t)):s(t,...r)};let c,l,u=!1,f=Math.random();ze=ze.then(e=>{[c,l]=e,u=!0})}else{const r=[De,Math.random()].join("-").replace(/\W/g,"-"),n=new BroadcastChannel("dc78209b-186c-4f83-80e9-406becb7d9f3");n.onmessage=async t=>{const[s,a,o]=t.data;if(a===r)for(const[t,[r,a]]of e)if(r===o){await a.promise;let e=t.length;for(;e--&&!t[e];);n.postMessage([s,t.slice(0,e+1)]);break}};const{notify:s}=Ve;Ve={notify(t,...r){const n=e.get(t);return n?(n[1].resolve(),0):s(t,...r)}};let a="",o=null;const i=(e,r)=>{let n,s=!0;e.getRegistration(a).then(t=>t??e.register(a,r)).then(function r(o){const{controller:i}=e;if(s=s&&!!i,n=o.installing||o.waiting||o.active,"activated"===n.state){if(s){if(i.scriptURL===a)return Fe(Ne);o.unregister()}location.reload()}else t(n,"statechange",()=>r(o),{once:!0})})};Ce=(e,t)=>{if(!o){const r=new URL(e,location.href);a=`${r.protocol}//${r.host}${r.pathname}`,i(navigator.serviceWorker,t),o=ze}return o}}}const{setPrototypeOf:Ge}=Reflect;let{postMessage:Qe}=globalThis;const Ze=Te(),et=Je.prototype;addEventListener("message",e=>{qe(e);const[t,r,n]=e.data,[s]=e.ports;r&&(Ge(s,et),t&&(Qe=Ye)),Ze.resolve([t,r,n,s])},{once:!0});var tt=async e=>{const[t,r,n,s]=await Ce().then(()=>Ze.promise),a=!!t,o=Ue||!!r,i=e?.transform,c=(e?.decoder||ee)(_e),l=!1!==e?.transfer;let u,f,h,p;if(o){const t=new(r?Xe:SharedArrayBuffer)(e?.minByteLength||32767,{maxByteLength:e?.maxByteLength||16777216});u=new Int32Array(t),r?(({wait:p}=Ve),He(u)):(({load:f,pause:h,wait:p}=Atomics),h&&(p=(e,t)=>{do{h()}while(f(e,t)<1)}))}const[g,y]=Oe(String),d=new Map,w=je(null),b=new Proxy(w,{get(e,r){if("then"===r)return;let n=d.get(r);return n||d.set(r,n=(...e)=>{const n=((e,t)=>{let r=ke;return e&&Ee.has(t.at(-1)||ke)&&(r=t.pop(),Ee.delete(r)),r})(l,e),f=[u,r,i?e.map(i):e];if(o){a?Qe({ID:t,data:f},n):s.postMessage(f,n),p(u,0),u[0]=0;const e=u[1]?c(u[1],u.buffer):void 0;if(e instanceof Error)throw e;return e}{const[e,t]=g();return f[0]=e,s.postMessage(f,n),t}}),n},set:We});return s.addEventListener("message",async({data:e})=>{"string"==typeof e[0]?y.apply(null,e):(await(async(e,t,r)=>{try{const n=await t[e[1]].apply(null,e[2]);e[1]=r?r(n):n,e[2]=null}catch(t){e[2]=t}})(e,w,i),s.postMessage(e))}),s.start(),{native:Ue,proxy:b,ffi_timeout:n,sync:o,transfer:Le}},rt=async e=>{const n=await tt({...e,decoder:e?.decoder||ee}),s=Be({...e,buffer:!0,reflect:n.proxy[t],timeout:n.ffi_timeout});return n.proxy[r]=s.reflect,{...n,window:s.global,isWindowProxy:s.isProxy,ffi:{assign:s.assign,direct:s.direct,evaluate:s.evaluate,gather:s.gather,query:s.query}}};export{rt as default};
