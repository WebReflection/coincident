const e="72ba9dfa",t="="+e,r="-"+e;let s=0;const n=s++,a=s++;s++;const o=s++,i=s++,c=s++,l=s++,u=s++,f=s++,p=s++,h=s++,g=s++,y=s++,d=s++,w=s++,b=s++,m=s++,v=s++,M=s++,$=s++,x=s++,S=s++,P=s++,A=s++,B=s++,T=s++;const O=globalThis.ImageData||class{},k=new TextDecoder;new TextEncoder;const E=new Map(Reflect.ownKeys(Symbol).map(e=>[Symbol[e],`@${String(e)}`])),L=e=>{switch(e[0]){case"@":return Symbol[e.slice(1)];case"#":return Symbol.for(e.slice(1));case"!":return Symbol(e.slice(1));default:return Symbol()}},R=e=>E.get(e)||((e,t)=>void 0===t?"?":void 0===Symbol.keyFor(e)?`!${t}`:`#${t}`)(e,e.description),U=Object.defineProperty,j=Object.assign,D=Array.isArray,I=ArrayBuffer.isView,_=(e,t)=>[e,t],W=e=>e,q=[],K={},F=function(){},N=e=>(t,r=new Map)=>{for(let s=0,n=t.length;s<n;s++)t[s]=e(t[s],r);return t},z=([e,t])=>0===e?t:L(t),C=e=>"string"==typeof e?_(0,e):_(16,R(e)),H=new ArrayBuffer(8),V=new DataView(H),J=new Uint8Array(H),X=(e,t,r)=>(e.set(t,r),r),Y=e=>{J[0]=e[Z++],J[1]=e[Z++],J[2]=e[Z++],J[3]=e[Z++],J[4]=e[Z++],J[5]=e[Z++],J[6]=e[Z++],J[7]=e[Z++]},G=e=>(J[0]=e[Z++],J[1]=e[Z++],J[2]=e[Z++],J[3]=e[Z++],V.getUint32(0,!0)),Q=(e,t)=>{switch(e[Z++]){case i:return Y(e),V.getFloat64(0,!0);case c:return e[Z++];case x:{const r=X(t,Z-1,{});for(let s=0,n=G(e);s<n;s++)r[Q(e,t)]=Q(e,t);return r}case b:{const r=X(t,Z-1,[]);for(let s=0,n=G(e);s<n;s++)r.push(Q(e,t));return r}case A:{const r=Z-1,s=Q(e,t);return X(t,r,new globalThis[s](Q(e,t)))}case m:{const r=Z-1,s=G(e);return X(t,r,e.slice(Z,Z+=s).buffer)}case d:{const r=Z-1,s=G(e);return X(t,r,k.decode(e.slice(Z,Z+=s)))}case v:return X(t,Z-1,new Date(Q(e,t)));case $:{const r=X(t,Z-1,new Map);for(let s=0,n=G(e);s<n;s++)r.set(Q(e,t),Q(e,t));return r}case P:{const r=X(t,Z-1,new Set);for(let s=0,n=G(e);s<n;s++)r.add(Q(e,t));return r}case M:{const r=Q(e,t),s=Q(e,t),n=Q(e,t),a=new(globalThis[r]||Error)(s);return X(t,Z-1,U(a,"stack",{value:n}))}case B:{const r=Q(e,t),s=Q(e,t),n=Q(e,t),a=Q(e,t),o=Q(e,t);return X(t,Z-1,new O(r,s,n,{colorSpace:a,pixelFormat:o}))}case S:{const r=Q(e,t),s=Q(e,t);return X(t,Z-1,new RegExp(r,s))}case n:return!1;case a:return!0;case l:return NaN;case u:return 1/0;case f:return-1/0;case p:return 0;case h:return-0;case o:return null;case g:return Y(e),V.getBigInt64(0,!0);case y:return Y(e),V.getBigUint64(0,!0);case w:return L(Q(e,t));case T:return t.get(G(e));default:return}};let Z=0;const ee=({byteOffset:e=0}={})=>(t,r)=>{return s=new Uint8Array(r,e,t),Z=0,Q(s,new Map);var s};let te=0;const re=te++,se=te++,ne=te++,ae=te++,oe=te++,ie=te++,ce=te++,le=te++,ue=te++,fe=te++,pe=te++,he=te++,ge=te++,ye=te++,de=te++;te++;const we=te++,be=te++,{getPrototypeOf:me}=Object,{toString:ve}=K,Me=(e,t=ve.call(e).slice(8,-1))=>t in globalThis?t:Me(me(e)||K),$e=(e,t)=>new ArrayBuffer(e,{maxByteLength:t}),xe=([e,t],r)=>{const s=r?e.byteLength:e.length;if(r){if(t){const r=$e(s,t);new Uint8Array(r).set(new Uint8Array(e)),e=r}}else{const r=t?$e(s,t):new ArrayBuffer(s);new Uint8Array(r).set(e),e=r}return e};const Se=/\[('|")?(.+?)\1\]/g,Pe=(e,t)=>e?.[t];var Ae=e=>{const t=[],r=e=>{const r=t.splice(e);for(;e<r.length;)r[e++].delete(r[e++])};return class s extends Map{static keys=Symbol();static proto=Symbol();drop(e,t){return e!==s.proto&&super.delete(s.keys),super.delete(e),t}set(s,n){return((s,n)=>{t.push(s,n)<3&&setTimeout(r,e,0)})(super.set(s,n),s),n}}},Be=({reflect:e=W,transform:t=W,released:r=W,buffer:s=!1,timeout:n=-1}=K)=>{const a=N(z),o=N(C),i=e=>{if(!D(e))return e;const[t,r]=e;if(1&t)return u(t,r);switch(t){case 2:return A;case 0:return r;case 16:return L(r);case 32:return BigInt(r);case 68:return(([e,t,r,s],n)=>{const a=xe(t,n),o=globalThis[e];return s?new o(a,r,s):new o(a,r)})(r,s);case 64:return xe(r,s)}},c=(e,r=new Map)=>{switch(typeof e){case"object":{if(null===e)break;if(e===globalThis)return P;if(S in e)return w;let s=r.get(e);if(!s){const n=t(e);if(b||!d.has(n)){if(D(n)){const t=[];s=_(4,t),r.set(e,s);for(let e=0,s=n.length;e<s;e++)t[e]=c(n[e],r);return s}if(!(I(n)||n instanceof ArrayBuffer||"Object"!==Me(n))){const t={};s=_(2,t),r.set(e,s);for(const e in n)t[e]=c(n[e],r);return s}}s=_(0,n),r.set(e,s)}return s}case"function":{if(S in e)return w;let s=r.get(e);if(!s){const n=t(e);s=_(8,v(n)),r.set(e,s)}return s}case"symbol":return _(16,R(e))}return e},l=N(c),u=(e,t)=>{let r=x.get(t),s=r?.deref();return s||(r&&B.unregister(r),s=9===e?new Proxy(F,new y(e,t)):new Proxy(3===e?K:q,new g(e,t)),r=new WeakRef(s),x.set(t,r),B.register(s,t,r)),s},f=e=>{switch(typeof e){case"object":if(null===e)break;case"function":return S in e}return!1},p=-1<n,h=p?Ae(n):Map;class g{constructor(e,t){this.t=e,this.v=t,p&&(this.$=new h)}get(t,r){if(p&&this.$.has(r))return this.$.get(r);const s=e(fe,this.v,C(r));return p?s[0]?this.$.set(r,i(s[1])):i(s[1]):i(s)}set(t,r,s){const n=e(we,this.v,C(r),c(s));return p?this.$.drop(r,n):n}has(t,r){return r===S?(w=[this.t,this.v],!0):e(ge,this.v,C(r))}_oK(){return a(e(de,this.v),x)}ownKeys(e){return p?this.$.has(h.keys)?this.$.get(h.keys):this.$.set(h.keys,this._oK()):this._oK()}getOwnPropertyDescriptor(t,r){const s=i(e(pe,this.v,C(r)));if(s)for(const e in s)s[e]=i(s[e]);return s}defineProperty(t,r,s){const n=e(le,this.v,C(r),c(s));return p?this.$.drop(r,n):n}deleteProperty(t,r){const s=e(ue,this.v,C(r));return p?this.$.drop(r,s):s}_gPO(){return i(e(he,this.v))}getPrototypeOf(e){return p?this.$.has(h.proto)?this.$.get(h.proto):this.$.set(h.proto,this._gPO()):this._gPO()}setPrototypeOf(t,r){const s=e(be,this.v,c(r));return p?this.$.drop(h.proto,s):s}isExtensible(t){return e(ye,this.v)}preventExtensions(e){return!1}}class y extends g{construct(t,r){return i(e(ce,this.v,l(r)))}apply(t,r,s){const n=new Map;return i(e(ie,this.v,c(r,n),l(s,n)))}get(e,t){switch(t){case"apply":return(t,r)=>this.apply(e,t,r);case"call":return(t,...r)=>this.apply(e,t,r);default:return super.get(e,t)}}}let d,w,b=!0;const{apply:m}=Reflect,{id:v,ref:M,unref:$}=((e=0,t=new Map,r=new Map)=>({clear:()=>{t.clear(),r.clear()},id:s=>{let n=r.get(s);if(void 0===n){for(;t.has(n=e++););t.set(n,s),r.set(s,n)}return n},ref:e=>t.get(e),unref:e=>(r.delete(t.get(e)),t.delete(e))}))(),x=new Map,S=Symbol("reflected-ffi"),P=_(2,null),A=new Proxy(K,new g(2,null)),B=new FinalizationRegistry(t=>{x.delete(t),e(re,t)});return{global:A,isProxy:f,assign(t,...r){const s=f(t),n=j(s?{}:t,...r);return s&&e(se,w[1],c(n)),t},direct:e=>(b&&(b=!1,d=new WeakSet),d.add(e),e),evaluate:(t,...r)=>i(e(ne,null,function(e=this){return String(e).replace(/^(async\s*)?(\bfunction\b)?(.*?)\(/,(e,t,r,s)=>s&&!r?`${t||""}function ${s}(`:e)}(t),l(r))),gather(t,...r){const s=f(t),n=s?i:e=>t[e];s&&(r=e(ae,w[1],o(r,x)));for(let e=0;e<r.length;e++)r[e]=n(r[e]);return r},query:(t,r)=>f(t)?i(e(oe,w[1],r)):((e,t)=>t.replace(Se,".$2").split(".").reduce(Pe,e))(t,r),reflect:async(e,t,...s)=>{switch(e){case ie:{const[e,r]=s;for(let e=0,t=r.length;e<t;e++)r[e]=i(r[e]);return c(await m(M(t),i(e),r))}case re:return r(M(t)),$(t)}}}};var Te=Promise.withResolvers.bind(Promise),Oe=(e=e=>e)=>{const t=new Map;let r=0;return[()=>{let s;do{s=e(r++)}while(t.has(s));const n=Te();return t.set(s,n),[s,n.promise]},(e,r,s)=>{const n=t.get(e);t.delete(e),s?n?.reject(s):n?.resolve(r)}]};const ke=[],Ee=new WeakSet,Le=(...e)=>(Ee.add(e),e);let{SharedArrayBuffer:Re}=globalThis,Ue=!0;try{new Re(4,{maxByteLength:8})}catch(e){Ue=!1,Re=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const{create:je}=Object,De=`coincident-${Ue?crypto.randomUUID():Math.random().toString(36).substring(2)}`,Ie=2*Int32Array.BYTES_PER_ELEMENT,_e={byteOffset:Ie},We=(e,t,r)=>{const s="then"!==t;return s&&(e[t]=r),s},qe=e=>{e.stopImmediatePropagation(),e.preventDefault()},[Ke,Fe]=Oe();let[Ne,ze]=Ke(),Ce=()=>ze,He=()=>{},{Atomics:Ve,MessagePort:Je,SharedArrayBuffer:Xe,postMessage:Ye}=globalThis;if(Ue)Fe(Ne);else{Xe=Re;const e=new Map,t=(e,...t)=>{e.addEventListener(...t)};if("importScripts"in globalThis){He=t=>{e.set(t,null)};const r=t=>{const r=t[0],s=f++;return e.set(r,s),[s,r,t]},s=Ye;Ye=function(e,t){if(u){const n={ID:e.ID,data:r(e.data)};s(n,t)}else ze.then(()=>this.postMessage(e,t))},Je=class extends Je{postMessage(e,t){u?super.postMessage(r(e),t):ze.then(()=>this.postMessage(e,t))}},t(globalThis,"message",e=>{qe(e),Fe(Ne,e.data)},{once:!0});const{wait:n}=Ve,{parse:a}=JSON,o=t=>{const r=new XMLHttpRequest;try{if(r.timeout=3e3,r.open("POST",`${l}?sabayon`,!1),r.setRequestHeader("Content-Type","application/json"),r.send(`["${c}",${e.get(t)}]`),200===r.status)return r;throw r}catch{return r.abort(),o(t)}},i=(e,t)=>(e.set(a(t.responseText)),"ok");Ve={wait:(t,...r)=>e.has(t)?i(t,o(t)):n(t,...r)};let c,l,u=!1,f=Math.random();ze=ze.then(e=>{[c,l]=e,u=!0})}else{const r=[De,Math.random()].join("-").replace(/\W/g,"-"),s=new BroadcastChannel("dc78209b-186c-4f83-80e9-406becb7d9f3");s.onmessage=async t=>{const[n,a,o]=t.data;if(a===r)for(const[t,[r,a]]of e)if(r===o){await a.promise;let e=t.length;for(;e--&&!t[e];);s.postMessage([n,t.slice(0,e+1)]);break}};const{notify:n}=Ve;Ve={notify(t,...r){const s=e.get(t);return s?(s[1].resolve(),0):n(t,...r)}};let a="",o=null;const i=(e,r)=>{let s,n=!0;e.getRegistration(a).then(t=>t??e.register(a,r)).then(function r(o){const{controller:i}=e;if(n=n&&!!i,s=o.installing||o.waiting||o.active,"activated"===s.state){if(n){if(i.scriptURL===a)return Fe(Ne);o.unregister()}location.reload()}else t(s,"statechange",()=>r(o),{once:!0})})};Ce=(e,t)=>{if(!o){const r=new URL(e,location.href);a=`${r.protocol}//${r.host}${r.pathname}`,i(navigator.serviceWorker,t),o=ze}return o}}}const{setPrototypeOf:Ge}=Reflect;let{postMessage:Qe}=globalThis;const Ze=Te(),et=Je.prototype;addEventListener("message",e=>{qe(e);const[t,r,s]=e.data,[n]=e.ports;r&&(Ge(n,et),t&&(Qe=Ye)),Ze.resolve([t,r,s,n])},{once:!0});var tt=async e=>{const[t,r,s,n]=await Ce().then(()=>Ze.promise),a=!!t,o=Ue||!!r,i=e?.transform,c=(e?.decoder||ee)(_e),l=!1!==e?.transfer;let u,f,p,h;if(o){const t=new(r?Xe:SharedArrayBuffer)(e?.minByteLength||32767,{maxByteLength:e?.maxByteLength||16777216});u=new Int32Array(t),r?(({wait:h}=Ve),He(u)):(({load:f,pause:p,wait:h}=Atomics),p&&(h=(e,t)=>{do{p()}while(f(e,t)<1)}))}const[g,y]=Oe(String),d=new Map,w=je(null),b=new Proxy(w,{get(e,r){if("then"===r)return;let s=d.get(r);return s||d.set(r,s=(...e)=>{const s=((e,t)=>{let r=ke;return e&&Ee.has(t.at(-1)||ke)&&(r=t.pop(),Ee.delete(r)),r})(l,e),f=[u,r,i?e.map(i):e];if(o){a?Qe({ID:t,data:f},s):n.postMessage(f,s),h(u,0),u[0]=0;const e=u[1]?c(u[1],u.buffer):void 0;if(e instanceof Error)throw e;return e}{const[e,t]=g();return f[0]=e,n.postMessage(f,s),t}}),s},set:We});return n.addEventListener("message",async({data:e})=>{"string"==typeof e[0]?y.apply(null,e):(await(async(e,t,r)=>{try{const s=await t[e[1]].apply(null,e[2]);e[1]=r?r(s):s,e[2]=null}catch(t){e[2]=t}})(e,w,i),n.postMessage(e))}),n.start(),{native:Ue,proxy:b,ffi_timeout:s,sync:o,transfer:Le}},rt=async e=>{const s=await tt({...e,decoder:e?.decoder||ee}),n=Be({...e,buffer:!0,reflect:s.proxy[t],timeout:s.ffi_timeout});return s.proxy[r]=n.reflect,{...s,window:n.global,isWindowProxy:n.isProxy,ffi:{assign:n.assign,direct:n.direct,evaluate:n.evaluate,gather:n.gather,query:n.query}}};export{rt as default};
