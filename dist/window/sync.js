let e=0;const t=e++,r=e++,n=e++,s=e++,a=e++,o=e++,i=e++,c=e++,l=e++,u=e++,f=e++,p=e++,h=e++,g=e++,y=e++;e++;const d=e++,m=e++;const b=globalThis.ImageData||class{},w=new Map(Reflect.ownKeys(Symbol).map(e=>[Symbol[e],`@${String(e)}`])),k=e=>{switch(e[0]){case"@":return Symbol[e.slice(1)];case"#":return Symbol.for(e.slice(1));case"!":return Symbol(e.slice(1));default:return Symbol()}},v=e=>w.get(e)||((e,t)=>void 0===t?"?":void 0===Symbol.keyFor(e)?`!${t}`:`#${t}`)(e,e.description),x=Object.assign,T=Array.from,M=Array.isArray,R=ArrayBuffer.isView,U=(e,t)=>[e,t],L=e=>e,S={},E=e=>(t,r=new Map)=>{for(let n=0,s=t.length;n<s;n++)t[n]=e(t[n],r);return t},O=([e,t])=>0===e?t:k(t),$=e=>"string"==typeof e?U(0,e):U(16,v(e)),{getPrototypeOf:j}=Object,{construct:A}=Reflect,{toStringTag:P}=Symbol,{toString:B}=S,W=(e,t=e[P])=>t in globalThis?t:W(A(j(e.constructor),[0])),D=(e,t)=>[t?e:T(new Uint8Array(e)),e.resizable?e.maxByteLength:0],I=/\[('|")?(.+?)\1\]/g,N=(e,t)=>e?.[t];var _=(e,t)=>t.replace(I,".$2").split(".").reduce(N,e),z=(e,...t)=>t.map(F,e);function F(e){return"string"==typeof e?_(this,e):this[e]}const q=globalThis.Node||class{},{apply:C,construct:J,defineProperty:K,deleteProperty:H,get:V,getOwnPropertyDescriptor:Y,getPrototypeOf:X,has:G,isExtensible:Q,ownKeys:Z,set:ee,setPrototypeOf:te}=Reflect;var re=({reflect:e=L,transform:w=L,remote:T=L,module:j=e=>import(e),buffer:A=!1,timeout:P=-1}=S)=>{const B=(t,r=new Map)=>{if(!M(t))return t;const[n,s]=t;switch(n){case 2:{if(null===s)return globalThis;let e=r.get(t);if(!e){e=s,r.set(t,s);for(const e in s)s[e]=B(s[e],r)}return e}case 4:return r.get(t)||(r.set(t,s),N(s,r));case 8:{let t=le.get(s),r=t?.deref();return r||(t&&fe.unregister(t),r=function(...t){T.apply(this,t);for(let e=0,r=t.length;e<r;e++)t[e]=I(t[e]);return e(o,s,I(this),t).then(B)},t=new WeakRef(r),le.set(s,t),fe.register(r,s,t)),r}case 16:return k(s);default:return 1&n?ae(s):s}},I=e=>{switch(typeof e){case"object":{if(null===e)break;if(e===globalThis)return ue;const t=w(e);return he&&pe.has(t)||t instanceof b?U(0,t):R(t)?U(68,((e,t)=>{const{BYTES_PER_ELEMENT:r,byteOffset:n,buffer:s,length:a}=e;return[W(e),D(s,t),n,a!==(s.byteLength-n)/r?a:0]})(t,A)):t instanceof ArrayBuffer?U(64,D(t,A)):U(M(t)?5:3,se(t))}case"function":return U(9,se(w(e)));case"symbol":return U(16,v(e));case"bigint":return U(32,e.toString())}return e},N=E(B),F=E(O),re=E($),{clear:ne,id:se,ref:ae,unref:oe}=((e=0,t=new Map,r=new Map)=>({clear:()=>{t.clear(),r.clear()},id:n=>{let s=r.get(n);if(void 0===s){for(;t.has(s=e++););t.set(s,n),r.set(n,s)}return s},ref:e=>t.get(e),unref:e=>(r.delete(t.get(e)),t.delete(e))}))(),ie=/^(?:[0-9]+|length)$/,ce=-1<P,le=new Map,ue=U(2,null),fe=new FinalizationRegistry(r=>{le.delete(r),e(t,r)});let pe,he=!1;return{assign:x,gather:z,query:_,direct:e=>(he||(he=!0,pe=new WeakSet),pe.add(e),e),evaluate:(e,...t)=>C(e,null,t),reflect(e,b,...w){const k=null===b,v=k?globalThis:ae(b);switch(e){case u:{const e=O(w[0]),t=k&&"import"===e,r=t?j:V(v,e),n=I(r);if(!ce)return n;let s,a=t,o=v;if(!t&&!(o instanceof q||M(o)&&"string"==typeof e&&ie.test(e)))if(e in v){for(;!(s=Y(o,e))&&(o=X(o),o););a=!!s&&"value"in s}else a=!0;return[a,n]}case o:{const e=new Map;return I(C(v,B(w[0],e),N(w[1],e)))}case d:return ee(v,O(w[0]),B(w[1]));case h:return G(v,O(w[0]));case y:return re(Z(v),le);case i:return I(J(v,N(w[0])));case f:{const e=Y(v,O(w[0]));if(e)for(const t in e)e[t]=I(e[t]);return e}case c:return K(v,O(w[0]),B(w[1]));case l:return H(v,O(w[0]));case p:return I(X(v));case m:return te(v,B(w[0]));case r:return void x(v,B(w[0]));case n:{const e=B(w[0]),t=Function(`return(${e}).apply(null,arguments)`);return I(C(t,null,N(w[1])))}case s:for(let e,t=0,r=(w=F(w[0],le)).length;t<r;t++)e=w[t],w[t]=I("string"==typeof e?_(v,e):v[e]);return w;case a:return I(_(v,w[0]));case t:return oe(b);case g:return Q(v)}},terminate(){for(const e of le.values())fe.unregister(e);le.clear(),ne()}}};const{addEventListener:ne}=EventTarget.prototype,se=new WeakMap;Reflect.defineProperty(EventTarget.prototype,"addEventListener",{value(e,t,r){const n=r?.invoke;if(n){let t=se.get(this);t||se.set(this,t=new Map),t.set(e,[].concat(n)),delete r.invoke}return ne.apply(this,arguments)}});let ae=0;const oe=ae++,ie=ae++,ce=ae++,le=ae++,ue=ae++,fe=ae++,pe=ae++,he=ae++,ge=ae++,ye=ae++,de=ae++,me=ae++,be=ae++,we=ae++,ke=ae++,ve=ae++,xe=ae++,Te=ae++,Me=ae++,Re=ae++,Ue=ae++,Le=ae++,Se=ae++,Ee=ae++,Oe=ae++,$e=ae++,je=ae++,Ae=ae++;class Pe{static push(e,t){e.sync(!1),e._(t,t.length)}constructor(e,t){const r=[];this.l=0,this.o=r,this.v=new Uint8Array(e,t),this.push=r.push.bind(r)}get length(){return this.l+this.o.length}sync(e){const t=this.o,r=t.length;r&&this._(e?t:t.splice(0),r)}_(e,t){const{buffer:r,byteOffset:n}=this.v,s=this.l;this.l+=t,t+=n+s,r.byteLength<t&&r.grow(t),this.v.set(e,s)}}new TextDecoder;const Be=new TextEncoder,We=new ArrayBuffer(8),De=new DataView(We),Ie=new Uint8Array(We),{isNaN:Ne,isFinite:_e,isInteger:ze}=Number,{ownKeys:Fe}=Reflect,{is:qe}=Object,Ce=(e,t,r)=>{const n=r.get(e),s=!n;return s?(De.setUint32(0,t.length,!0),r.set(e,[Ie[0],Ie[1],Ie[2],Ie[3]])):t.push(Ae,n[0],n[1],n[2],n[3]),s},Je=(e,t,r)=>{De.setUint32(0,r,!0),e.push(t,Ie[0],Ie[1],Ie[2],Ie[3])},Ke=(e,t,r)=>{switch(typeof e){case"number":e&&_e(e)?ze(e)&&e<256&&-1<e?t.push(fe,e):(De.setFloat64(0,e,!0),t.push(ue,Ie[0],Ie[1],Ie[2],Ie[3],Ie[4],Ie[5],Ie[6],Ie[7])):Ne(e)?t.push(pe):e?t.push(e<0?ge:he):t.push(qe(e,0)?ye:de);break;case"object":switch(!0){case null===e:t.push(le);break;case!Ce(e,t,r):break;case M(e):{const n=e.length;Je(t,ve,n);for(let s=0;s<n;s++)Ke(e[s],t,r);break}case R(e):if(t.push(Ee),Ke(W(e),t,r),e=e.buffer,!Ce(e,t,r))break;case e instanceof ArrayBuffer:{const r=new Uint8Array(e);Je(t,xe,r.length),Ve(t,r);break}case e instanceof Date:t.push(Te),Ke(e.getTime(),t,r);break;case e instanceof Map:Je(t,Re,e.size);for(const[n,s]of e)Ke(n,t,r),Ke(s,t,r);break;case e instanceof Set:Je(t,Se,e.size);for(const n of e)Ke(n,t,r);break;case e instanceof Error:t.push(Me),Ke(e.name,t,r),Ke(e.message,t,r),Ke(e.stack,t,r);break;case e instanceof b:t.push(Oe),Ke(e.data,t,r),Ke(e.width,t,r),Ke(e.height,t,r),Ke(e.colorSpace,t,r),Ke(e.pixelFormat,t,r);break;case e instanceof RegExp:t.push(Le),Ke(e.source,t,r),Ke(e.flags,t,r);break;case e instanceof File:t.push(je),Ke(e.name,t,r),Ke(e.lastModified,t,r);case e instanceof Blob:{const n=e.size;t.push($e),Ke(e.type,t,r),Ke(n,t,r);const s=t.length;Ve(t,new Uint8Array(n)),He.push(e.arrayBuffer().then(e=>[s,e]));break}default:if("toJSON"in e){const n=e.toJSON();Ke(n===e?null:n,t,r)}else{const n=Fe(e),s=n.length;Je(t,Ue,s);for(let a=0;a<s;a++){const s=n[a];Ke(s,t,r),Ke(e[s],t,r)}}}break;case"string":if(Ce(e,t,r)){const r=Be.encode(e);Je(t,we,r.length),Ve(t,r)}break;case"boolean":t.push(e?ie:oe);break;case"symbol":t.push(ke),Ke(v(e),t,r);break;case"bigint":{let r=me;9223372036854775807n<e?(De.setBigUint64(0,e,!0),r=be):De.setBigInt64(0,e,!0),t.push(r,Ie[0],Ie[1],Ie[2],Ie[3],Ie[4],Ie[5],Ie[6],Ie[7]);break}default:t.push(ce)}},He=[];let Ve=(e,t)=>{for(let r=e.push,n=0,s=t.length;n<s;n+=32767)r.apply(e,t.subarray(n,n+32767))};const Ye=({byteOffset:e=0,Array:t=Pe}={})=>(r,n)=>{const s=new t(n,e);Ve=t.push,Ke(r,s,new Map);const a=s.length;return s.sync(!0),He.length?Promise.all(He.splice(0)).then(t=>{const r=new Uint8Array(n,e);for(const[e,n]of t)r.set(new Uint8Array(n),e);return a}):a},Xe="59317780",Ge="="+Xe,Qe="-"+Xe;var Ze=Promise.withResolvers.bind(Promise),et=(e=e=>e)=>{const t=new Map;let r=0;return[()=>{let n;do{n=e(r++)}while(t.has(n));const s=Ze();return t.set(n,s),[n,s.promise]},(e,r,n)=>{const s=t.get(e);t.delete(e),n?s?.reject(n):s?.resolve(r)}]};const tt=[],rt=new WeakSet,nt=(...e)=>(rt.add(e),e);let{SharedArrayBuffer:st}=globalThis,at=!0;try{new st(4,{maxByteLength:8})}catch(e){at=!1,st=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const{assign:ot,create:it}=Object,ct=`coincident-${at?crypto.randomUUID():Math.random().toString(36).substring(2)}`,lt={byteOffset:2*Int32Array.BYTES_PER_ELEMENT},ut=(e,t,r)=>{const n="then"!==t;return n&&(e[t]=r),n},ft=e=>{e.stopImmediatePropagation(),e.preventDefault()},pt=(e,t=-1)=>e?.reflected_ffi_timeout??t,{defineProperty:ht}=Object,[gt,yt]=et();let[dt,mt]=gt(),bt=()=>mt,{Atomics:wt,MessageChannel:kt,Worker:vt}=globalThis;if(at)yt(dt);else{const e=new Map,t=(e,...t)=>{e.addEventListener(...t)};if("importScripts"in globalThis){t(globalThis,"message",e=>{ft(e),yt(dt,e.data)},{once:!0});const{wait:r}=wt,{parse:n}=JSON,s=t=>{const r=new XMLHttpRequest;try{if(r.timeout=3e3,r.open("POST",`${i}?sabayon`,!1),r.setRequestHeader("Content-Type","application/json"),r.send(`["${o}",${e.get(t)}]`),200===r.status)return r;throw r}catch{return r.abort(),s(t)}},a=(e,t)=>(e.set(n(t.responseText)),"ok");let o,i;wt={wait:(t,...n)=>e.has(t)?a(t,s(t)):r(t,...n)},mt=mt.then(e=>{[o,i]=e})}else{const r=[ct,Math.random()].join("-").replace(/\W/g,"-"),n=new BroadcastChannel("dc78209b-186c-4f83-80e9-406becb7d9f3");n.onmessage=async t=>{const[s,a,o]=t.data;if(a===r)for(const[t,[r,a]]of e)if(r===o){await a.promise;let e=t.length;for(;e--&&!t[e];);n.postMessage([s,t.slice(0,e+1)]);break}};const s=t=>{const[r,n,s]=t.data;e.set(n,[r,Ze()]),ht(t,"data",{value:s})};kt=class extends kt{constructor(){super(),t(this.port1,"message",s)}},vt=class extends vt{constructor(e,t){super(e,t),super.postMessage([r,o])}};const{notify:a}=wt;wt={notify(t,...r){const n=e.get(t);return n?(n[1].resolve(),0):a(t,...r)}};let o="",i=null;const c=(e,r)=>{let n,s=!0;e.getRegistration(o).then(t=>t??e.register(o,r)).then(function r(a){const{controller:i}=e;if(s=s&&!!i,n=a.installing||a.waiting||a.active,"activated"===n.state){if(s){if(i.scriptURL===o)return yt(dt);a.unregister()}location.reload()}else t(n,"statechange",()=>r(a),{once:!0})})};bt=(e,t)=>{if(!i){const r=new URL(e,location.href);o=`${r.protocol}//${r.host}${r.pathname}`,c(navigator.serviceWorker,t),i=mt}return i}}}const xt="InstallTrigger"in globalThis?ct:"",Tt=e=>e,Mt=e=>e===Ge?"main":e===Qe?"worker":e;class Rt extends Event{#e;constructor(e){super("message"),this.#e=e}get data(){return this.#e}}var Ut=e=>{const t=e?.transform,r=pt(e),n=(e?.encoder||Ye)(lt),s=!1!==e?.transfer;return{Worker:class extends vt{constructor(e,a){const o=at?"":a?.serviceWorker||"",{notify:i}=o?wt:Atomics,{port1:c,port2:l}=new(o?kt:MessageChannel),[u,f]=et(Tt),p=new Map,h=it(null);o&&bt(o);let g="";super(e,ot({type:"module"},a)),this.proxy=new Proxy(h,{get:(e,r)=>{if("then"===r)return;let n=p.get(r);return n||p.set(r,n=(...e)=>{const n=((e,t)=>{let r=tt;return e&&M(t.at(-1))&&rt.has(t.at(-1))&&(r=t.pop(),rt.delete(r)),r})(s,e),[a,o]=u();return c.postMessage([a,r,t?e.map(t):e],n),((e,t)=>{if(g){const r=setTimeout(console.warn,3e3,`ðŸ’€ðŸ”’ - is proxy.${Mt(g)}() awaiting proxy.${Mt(t)}() ?`);e=e.then(e=>(clearTimeout(r),e),e=>(clearTimeout(r),Promise.reject(e)))}return e})(o,r)}),n},set:ut}),xt&&(at||o)&&super.addEventListener("message",e=>{const{data:t}=e;t?.ID===xt&&(ft(e),c.dispatchEvent(new Rt(t.data)))}),super.postMessage([xt,o,pt(a,r)],[l]),c.addEventListener("message",async({data:e})=>{const r=e[0],s=typeof r;if("number"===s)f.apply(null,e);else if(g=e[1],await(async(e,t,r)=>{try{const n=await t[e[1]].apply(null,e[2]);e[1]=r?r(n):n,e[2]=null}catch(t){e[2]=t}})(e,h,t),g="","string"===s)c.postMessage(e);else{const t=e[2]||e[1],s=void 0===t?0:n(t,r.buffer);r[1]="number"==typeof s?s:await s,r[0]=1,i(r,0)}}),c.start()}},native:at,transfer:nt}},Lt=e=>{const t=e?.import,r=pt(e),n=Ut({...e,encoder:e?.encoder||Ye});class s extends n.Worker{#t;constructor(e,n){const{proxy:s}=super(e,n),a=re({...n,buffer:!0,reflect:s[Qe],timeout:pt(n,r),remote(e){e instanceof Event&&(e=>{const{currentTarget:t,target:r,type:n}=e,s=se.get(t||r)?.get(n);if(s)for(const t of s)e[t]()})(e)},module:n?.import||t||(e=>import(new URL(e,location).href))});this.#t=a.terminate,this.ffi={assign:a.assign,direct:a.direct,evaluate:a.evaluate,gather:a.gather,query:a.query},s[Ge]=a.reflect}terminate(){this.#t(),super.terminate()}}return{...n,Worker:s}};const St=e=>new URL(e,location.href),{href:Et}=new URL("./worker.js",import.meta.url),{assign:Ot,keys:$t}=Object,jt=new Map;let At;var Pt=(e,t)=>{const r="string"!=typeof e;if(At??=Lt(r?e:t),r)return At;const{Worker:n}=At,{href:s}=St(e);let a,o=jt.get(s);if(!o){const e=crypto.randomUUID(),{promise:r,resolve:i}=Promise.withResolvers();if(t?.worker){const o=new Blob([`import coincident from '${Et}';`,`import * as $ from '${s}';`,"const{assign:a,keys:k}=Object,{proxy:p}=await coincident();",`a(p,$);p['${e}'](k($))`],{type:"text/javascript"}),c=URL.createObjectURL(o);r.then(()=>URL.revokeObjectURL(c)),a=new n(c,{...t,type:"module"}),a.proxy[e]=i}else a={proxy:null,terminate(){this.proxy=null}},import(s).then(e=>i($t(a.proxy=e)));o={terminate:()=>{jt.delete(s),a.terminate()},for(e){const s=new Blob([`import coincident from '${Et}';`,"const{proxy:p}=await coincident();globalThis.sync={};","for(let k of p.keys())sync[k]=(...a)=>p.invoke(k,a);",`await import('${St(e)}')`],{type:"text/javascript"}),o=URL.createObjectURL(s),i=new n(o,{...t,type:"module"});return i.proxy.keys=()=>r,i.proxy.invoke=(e,t)=>a.proxy[e](...t),{terminate:()=>{URL.revokeObjectURL(o),i.terminate()}}}},jt.set(s,Ot(o,At))}return o};export{Pt as default};
