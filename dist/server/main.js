var e=Promise.withResolvers.bind(Promise),t=(t=e=>e)=>{const r=new Map;let s=0;return[()=>{let n;do{n=t(s++)}while(r.has(n));const a=e();return r.set(n,a),[n,a.promise]},(e,t,s)=>{const n=r.get(e);r.delete(e),s?n?.reject(s):n?.resolve(t)}]};const r="b3e5cb6e",s="="+r,n="-"+r,a=s+"-ws",o=n+"-ws";let c=0;const i=c++,l=c++,u=c++,f=c++,p=c++,h=c++,g=c++,y=c++,d=c++,w=c++,b=c++,m=c++,v=c++,k=c++,T=c++,M=c++,x=c++,S=c++,E=c++,A=c++,B=c++,O=c++,U=c++,P=c++,R=c++,L=c++,$=c++,W=c++;const j=globalThis.ImageData||class{},F=new TextDecoder,N=new TextEncoder,_=new Map(Reflect.ownKeys(Symbol).map(e=>[Symbol[e],`@${String(e)}`])),D=e=>{switch(e[0]){case"@":return Symbol[e.slice(1)];case"#":return Symbol.for(e.slice(1));case"!":return Symbol(e.slice(1));default:return Symbol()}},I=e=>_.get(e)||((e,t)=>void 0===t?"?":void 0===Symbol.keyFor(e)?`!${t}`:`#${t}`)(e,e.description),z=Object.defineProperty,q=Object.assign,C=Array.from,J=Array.isArray,K=ArrayBuffer.isView,H=(e,t)=>[e,t],V=e=>e,Y={},X=e=>(t,r=new Map)=>{for(let s=0,n=t.length;s<n;s++)t[s]=e(t[s],r);return t},G=([e,t])=>0===e?t:D(t),Q=e=>"string"==typeof e?H(0,e):H(16,I(e)),Z=new ArrayBuffer(8),ee=new DataView(Z),te=new Uint8Array(Z),re=(e,t,r)=>(e.set(t,r),r),se=e=>{te[0]=e[oe++],te[1]=e[oe++],te[2]=e[oe++],te[3]=e[oe++],te[4]=e[oe++],te[5]=e[oe++],te[6]=e[oe++],te[7]=e[oe++]},ne=e=>(te[0]=e[oe++],te[1]=e[oe++],te[2]=e[oe++],te[3]=e[oe++],ee.getUint32(0,!0)),ae=(e,t)=>{switch(e[oe++]){case p:return se(e),ee.getFloat64(0,!0);case h:return e[oe++];case B:{const r=re(t,oe-1,{});for(let s=0,n=ne(e);s<n;s++)r[ae(e,t)]=ae(e,t);return r}case M:{const r=re(t,oe-1,[]);for(let s=0,n=ne(e);s<n;s++)r.push(ae(e,t));return r}case P:{const r=oe-1,s=ae(e,t);return re(t,r,new globalThis[s](ae(e,t)))}case x:{const r=oe-1,s=ne(e);return re(t,r,e.slice(oe,oe+=s).buffer)}case k:{const r=oe-1,s=ne(e);return re(t,r,F.decode(e.slice(oe,oe+=s)))}case S:return re(t,oe-1,new Date(ae(e,t)));case A:{const r=re(t,oe-1,new Map);for(let s=0,n=ne(e);s<n;s++)r.set(ae(e,t),ae(e,t));return r}case U:{const r=re(t,oe-1,new Set);for(let s=0,n=ne(e);s<n;s++)r.add(ae(e,t));return r}case E:{const r=ae(e,t),s=ae(e,t),n=ae(e,t),a=new(globalThis[r]||Error)(s);return re(t,oe-1,z(a,"stack",{value:n}))}case R:{const r=ae(e,t),s=ae(e,t),n=ae(e,t),a=ae(e,t),o=ae(e,t);return re(t,oe-1,new j(r,s,n,{colorSpace:a,pixelFormat:o}))}case O:{const r=ae(e,t),s=ae(e,t);return re(t,oe-1,new RegExp(r,s))}case i:return!1;case l:return!0;case g:return NaN;case y:return 1/0;case d:return-1/0;case w:return 0;case b:return-0;case f:return null;case m:return se(e),ee.getBigInt64(0,!0);case v:return se(e),ee.getBigUint64(0,!0);case T:return D(ae(e,t));case W:return t.get(ne(e));case L:{const r=ae(e,t),s=ae(e,t);return re(t,oe-1,new Blob([e.slice(oe,oe+=s)],{type:r}))}case $:{const r=oe-1,s=ae(e,t),n=ae(e,t),a=ae(e,t);return re(t,r,new File([a],s,{type:a.type,lastModified:n}))}default:return}};let oe=0;class ce{static push(e,t){e.sync(!1),e._(t,t.length)}constructor(e,t){const r=[];this.l=0,this.o=r,this.v=new Uint8Array(e,t),this.push=r.push.bind(r)}get length(){return this.l+this.o.length}sync(e){const t=this.o,r=t.length;r&&this._(e?t:t.splice(0),r)}_(e,t){const{buffer:r,byteOffset:s}=this.v,n=this.l;this.l+=t,t+=s+n,r.byteLength<t&&r.grow(t),this.v.set(e,n)}}const{getPrototypeOf:ie}=Object,{construct:le}=Reflect,{toStringTag:ue}=Symbol,{toString:fe}=Y,pe=(e,t=e[ue])=>t in globalThis?t:pe(le(ie(e.constructor),[0])),{isNaN:he,isFinite:ge,isInteger:ye}=Number,{ownKeys:de}=Reflect,{is:we}=Object,be=(e,t,r)=>{const s=r.get(e),n=!s;return n?(ee.setUint32(0,t.length,!0),r.set(e,[te[0],te[1],te[2],te[3]])):t.push(W,s[0],s[1],s[2],s[3]),n},me=(e,t,r)=>{ee.setUint32(0,r,!0),e.push(t,te[0],te[1],te[2],te[3])},ve=(e,t,r)=>{switch(typeof e){case"number":e&&ge(e)?ye(e)&&e<256&&-1<e?t.push(h,e):(ee.setFloat64(0,e,!0),t.push(p,te[0],te[1],te[2],te[3],te[4],te[5],te[6],te[7])):he(e)?t.push(g):e?t.push(e<0?d:y):t.push(we(e,0)?w:b);break;case"object":switch(!0){case null===e:t.push(f);break;case!be(e,t,r):break;case J(e):{const s=e.length;me(t,M,s);for(let n=0;n<s;n++)ve(e[n],t,r);break}case K(e):if(t.push(P),ve(pe(e),t,r),e=e.buffer,!be(e,t,r))break;case e instanceof ArrayBuffer:{const r=new Uint8Array(e);me(t,x,r.length),Te(t,r);break}case e instanceof Date:t.push(S),ve(e.getTime(),t,r);break;case e instanceof Map:me(t,A,e.size);for(const[s,n]of e)ve(s,t,r),ve(n,t,r);break;case e instanceof Set:me(t,U,e.size);for(const s of e)ve(s,t,r);break;case e instanceof Error:t.push(E),ve(e.name,t,r),ve(e.message,t,r),ve(e.stack,t,r);break;case e instanceof j:t.push(R),ve(e.data,t,r),ve(e.width,t,r),ve(e.height,t,r),ve(e.colorSpace,t,r),ve(e.pixelFormat,t,r);break;case e instanceof RegExp:t.push(O),ve(e.source,t,r),ve(e.flags,t,r);break;case e instanceof File:t.push($),ve(e.name,t,r),ve(e.lastModified,t,r);case e instanceof Blob:{const s=e.size;t.push(L),ve(e.type,t,r),ve(s,t,r);const n=t.length;Te(t,new Uint8Array(s)),ke.push(e.arrayBuffer().then(e=>[n,e]));break}default:if("toJSON"in e){const s=e.toJSON();ve(s===e?null:s,t,r)}else{const s=de(e),n=s.length;me(t,B,n);for(let a=0;a<n;a++){const n=s[a];ve(n,t,r),ve(e[n],t,r)}}}break;case"string":if(be(e,t,r)){const r=N.encode(e);me(t,k,r.length),Te(t,r)}break;case"boolean":t.push(e?l:i);break;case"symbol":t.push(T),ve(I(e),t,r);break;case"bigint":{let r=m;9223372036854775807n<e?(ee.setBigUint64(0,e,!0),r=v):ee.setBigInt64(0,e,!0),t.push(r,te[0],te[1],te[2],te[3],te[4],te[5],te[6],te[7]);break}default:t.push(u)}},ke=[];let Te=(e,t)=>{for(let r=e.push,s=0,n=t.length;s<n;s+=32767)r.apply(e,t.subarray(s,s+32767))};const Me=({byteOffset:e=0,Array:t=ce}={})=>(r,s)=>{const n=new t(s,e);Te=t.push,ve(r,n,new Map);const a=n.length;return n.sync(!0),ke.length?Promise.all(ke.splice(0)).then(t=>{const r=new Uint8Array(s,e);for(const[e,s]of t)r.set(new Uint8Array(s),e);return a}):a};let xe=class extends ArrayBuffer{value;transferToFixedLength(e){return this.value=new ArrayBuffer(e)}};const Se=new xe,Ee=Me({Array:class extends ce{constructor(e,t){super(e,t),this.e=[]}sync(e){if(super.sync(e),e){const e=this.l,t=this.v.byteOffset,r=this.v.buffer.transferToFixedLength(e+t),s=new Uint8Array(r,t);for(let e=this.e,t=0,r=0;r<e.length;r++){const n=e[r];s.set(n,t),t+=n.length}}return this}_(e,t){this.l+=t,this.e.push(e)}}}),Ae=async e=>await Ee(e,Se)?Se.value:Se,Be=e=>{return t=new Uint8Array(e),oe=0,ae(t,new Map);var t};let Oe=0;const Ue=Oe++,Pe=Oe++,Re=Oe++,Le=Oe++,$e=Oe++,We=Oe++,je=Oe++,Fe=Oe++,Ne=Oe++,_e=Oe++,De=Oe++,Ie=Oe++,ze=Oe++,qe=Oe++,Ce=Oe++;Oe++;const Je=Oe++,Ke=Oe++,He=(e,t)=>[t?e:C(new Uint8Array(e)),e.resizable?e.maxByteLength:0],Ve=/\[('|")?(.+?)\1\]/g,Ye=(e,t)=>e?.[t];var Xe=(e,t)=>t.replace(Ve,".$2").split(".").reduce(Ye,e),Ge=(e,...t)=>t.map(Qe,e);function Qe(e){return"string"==typeof e?Xe(this,e):this[e]}const Ze=globalThis.Node||class{},{apply:et,construct:tt,defineProperty:rt,deleteProperty:st,get:nt,getOwnPropertyDescriptor:at,getPrototypeOf:ot,has:ct,isExtensible:it,ownKeys:lt,set:ut,setPrototypeOf:ft}=Reflect;var pt=({reflect:e=V,transform:t=V,remote:r=V,module:s=e=>import(e),buffer:n=!1,timeout:a=-1}=Y)=>{const o=(t,s=new Map)=>{if(!J(t))return t;const[n,a]=t;switch(n){case 2:{if(null===a)return globalThis;let e=s.get(t);if(!e){e=a,s.set(t,a);for(const e in a)a[e]=o(a[e],s)}return e}case 4:return s.get(t)||(s.set(t,a),i(a,s));case 8:{let t=w.get(a),s=t?.deref();return s||(t&&m.unregister(t),s=function(...t){r.apply(this,t);for(let e=0,r=t.length;e<r;e++)t[e]=c(t[e]);return e(We,a,c(this),t).then(o)},t=new WeakRef(s),w.set(a,t),m.register(s,a,t)),s}case 16:return D(a);default:return 1&n?h(a):a}},c=e=>{switch(typeof e){case"object":{if(null===e)break;if(e===globalThis)return b;const r=t(e);return k&&v.has(r)||r instanceof j?H(0,r):K(r)?H(68,((e,t)=>{const{BYTES_PER_ELEMENT:r,byteOffset:s,buffer:n,length:a}=e;return[pe(e),He(n,t),s,a!==(n.byteLength-s)/r?a:0]})(r,n)):r instanceof ArrayBuffer?H(64,He(r,n)):H(J(r)?5:3,p(r))}case"function":return H(9,p(t(e)));case"symbol":return H(16,I(e));case"bigint":return H(32,e.toString())}return e},i=X(o),l=X(G),u=X(Q),{clear:f,id:p,ref:h,unref:g}=((e=0,t=new Map,r=new Map)=>({clear:()=>{t.clear(),r.clear()},id:s=>{let n=r.get(s);if(void 0===n){for(;t.has(n=e++););t.set(n,s),r.set(s,n)}return n},ref:e=>t.get(e),unref:e=>(r.delete(t.get(e)),t.delete(e))}))(),y=/^(?:[0-9]+|length)$/,d=-1<a,w=new Map,b=H(2,null),m=new FinalizationRegistry(t=>{w.delete(t),e(Ue,t)});let v,k=!1;return{assign:q,gather:Ge,query:Xe,direct:e=>(k||(k=!0,v=new WeakSet),v.add(e),e),evaluate:(e,...t)=>et(e,null,t),reflect(e,t,...r){const n=null===t,a=n?globalThis:h(t);switch(e){case _e:{const e=G(r[0]),t=n&&"import"===e,o=t?s:nt(a,e),i=c(o);if(!d)return i;let l,u=t,f=a;if(!t&&!(f instanceof Ze||J(f)&&"string"==typeof e&&y.test(e)))if(e in a){for(;!(l=at(f,e))&&(f=ot(f),f););u=!!l&&"value"in l}else u=!0;return[u,i]}case We:{const e=new Map;return c(et(a,o(r[0],e),i(r[1],e)))}case Je:return ut(a,G(r[0]),o(r[1]));case ze:return ct(a,G(r[0]));case Ce:return u(lt(a),w);case je:return c(tt(a,i(r[0])));case De:{const e=at(a,G(r[0]));if(e)for(const t in e)e[t]=c(e[t]);return e}case Fe:return rt(a,G(r[0]),o(r[1]));case Ne:return st(a,G(r[0]));case Ie:return c(ot(a));case Ke:return ft(a,o(r[0]));case Pe:return void q(a,o(r[0]));case Re:{const e=o(r[0]),t=Function(`return(${e}).apply(null,arguments)`);return c(et(t,null,i(r[1])))}case Le:for(let e,t=0,s=(r=l(r[0],w)).length;t<s;t++)e=r[t],r[t]=c("string"==typeof e?Xe(a,e):a[e]);return r;case $e:return c(Xe(a,r[0]));case Ue:return g(t);case qe:return it(a)}},terminate(){for(const e of w.values())m.unregister(e);w.clear(),f()}}};const{addEventListener:ht}=EventTarget.prototype,gt=new WeakMap;Reflect.defineProperty(EventTarget.prototype,"addEventListener",{value(e,t,r){const s=r?.invoke;if(s){let t=gt.get(this);t||gt.set(this,t=new Map),t.set(e,[].concat(s)),delete r.invoke}return ht.apply(this,arguments)}});const yt=[],dt=new WeakSet,wt=(...e)=>(dt.add(e),e);let{SharedArrayBuffer:bt}=globalThis,mt=!0;try{new bt(4,{maxByteLength:8})}catch(e){mt=!1,bt=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const{assign:vt,create:kt}=Object,Tt=`coincident-${mt?crypto.randomUUID():Math.random().toString(36).substring(2)}`,Mt={byteOffset:2*Int32Array.BYTES_PER_ELEMENT},xt=(e,t,r)=>{const s="then"!==t;return s&&(e[t]=r),s},St=e=>{e.stopImmediatePropagation(),e.preventDefault()},Et=(e,t=-1)=>e?.reflected_ffi_timeout??t,{defineProperty:At}=Object,[Bt,Ot]=t();let[Ut,Pt]=Bt(),Rt=()=>Pt,{Atomics:Lt,MessageChannel:$t,Worker:Wt}=globalThis;if(mt)Ot(Ut);else{const t=new Map,r=(e,...t)=>{e.addEventListener(...t)};if("importScripts"in globalThis){r(globalThis,"message",e=>{St(e),Ot(Ut,e.data)},{once:!0});const{wait:e}=Lt,{parse:s}=JSON,n=e=>{const r=new XMLHttpRequest;try{if(r.timeout=3e3,r.open("POST",`${c}?sabayon`,!1),r.setRequestHeader("Content-Type","application/json"),r.send(`["${o}",${t.get(e)}]`),200===r.status)return r;throw r}catch{return r.abort(),n(e)}},a=(e,t)=>(e.set(s(t.responseText)),"ok");let o,c;Lt={wait:(r,...s)=>t.has(r)?a(r,n(r)):e(r,...s)},Pt=Pt.then(e=>{[o,c]=e})}else{const s=[Tt,Math.random()].join("-").replace(/\W/g,"-"),n=new BroadcastChannel("dc78209b-186c-4f83-80e9-406becb7d9f3");n.onmessage=async e=>{const[r,a,o]=e.data;if(a===s)for(const[e,[s,a]]of t)if(s===o){await a.promise;let t=e.length;for(;t--&&!e[t];);n.postMessage([r,e.slice(0,t+1)]);break}};const a=r=>{const[s,n,a]=r.data;t.set(n,[s,e()]),At(r,"data",{value:a})};$t=class extends $t{constructor(){super(),r(this.port1,"message",a)}},Wt=class extends Wt{constructor(e,t){super(e,t),super.postMessage([s,c])}};const{notify:o}=Lt;Lt={notify(e,...r){const s=t.get(e);return s?(s[1].resolve(),0):o(e,...r)}};let c="",i=null;const l=(e,t)=>{let s,n=!0;e.getRegistration(c).then(r=>r??e.register(c,t)).then(function t(a){const{controller:o}=e;if(n=n&&!!o,s=a.installing||a.waiting||a.active,"activated"===s.state){if(n){if(o.scriptURL===c)return Ot(Ut);a.unregister()}location.reload()}else r(s,"statechange",()=>t(a),{once:!0})})};Rt=(e,t)=>{if(!i){const r=new URL(e,location.href);c=`${r.protocol}//${r.host}${r.pathname}`,l(navigator.serviceWorker,t),i=Pt}return i}}}const jt="InstallTrigger"in globalThis?Tt:"",Ft=e=>e,Nt=e=>e===s?"main":e===n?"worker":e;class _t extends Event{#e;constructor(e){super("message"),this.#e=e}get data(){return this.#e}}var Dt=e=>{const r=e?.transform,s=Et(e),n=(e?.encoder||Me)(Mt),a=!1!==e?.transfer;return{Worker:class extends Wt{constructor(e,o){const c=mt?"":o?.serviceWorker||"",{notify:i}=c?Lt:Atomics,{port1:l,port2:u}=new(c?$t:MessageChannel),[f,p]=t(Ft),h=new Map,g=kt(null);c&&Rt(c);let y="";super(e,vt({type:"module"},o)),this.proxy=new Proxy(g,{get:(e,t)=>{if("then"===t)return;let s=h.get(t);return s||h.set(t,s=(...e)=>{const s=((e,t)=>{let r=yt;return e&&dt.has(t.at(-1)||yt)&&(r=t.pop(),dt.delete(r)),r})(a,e),[n,o]=f();return l.postMessage([n,t,r?e.map(r):e],s),((e,t)=>{if(y){const r=setTimeout(console.warn,3e3,`💀🔒 - is proxy.${Nt(y)}() awaiting proxy.${Nt(t)}() ?`);e=e.then(e=>(clearTimeout(r),e),e=>(clearTimeout(r),Promise.reject(e)))}return e})(o,t)}),s},set:xt}),jt&&(mt||c)&&super.addEventListener("message",e=>{const{data:t}=e;t?.ID===jt&&(St(e),l.dispatchEvent(new _t(t.data)))}),super.postMessage([jt,c,Et(o,s)],[u]),l.addEventListener("message",async({data:e})=>{const t=e[0],s=typeof t;if("number"===s)p.apply(null,e);else if(y=e[1],await(async(e,t,r)=>{try{const s=await t[e[1]].apply(null,e[2]);e[1]=r?r(s):s,e[2]=null}catch(t){e[2]=t}})(e,g,r),y="","string"===s)l.postMessage(e);else{const r=e[2]||e[1],s=void 0===r?0:n(r,t.buffer);t[1]="number"==typeof s?s:await s,t[0]=1,i(t,0)}}),l.start()}},native:mt,transfer:wt}},It=e=>{const t=e?.import,r=Et(e),a=Dt({...e,encoder:e?.encoder||Me});class o extends a.Worker{#t;constructor(e,a){const{proxy:o}=super(e,a),c=pt({...a,buffer:!0,reflect:o[n],timeout:Et(a,r),remote(e){e instanceof Event&&(e=>{const{currentTarget:t,target:r,type:s}=e,n=gt.get(t||r)?.get(s);if(n)for(const t of n)e[t]()})(e)},module:a?.import||t||(e=>import(new URL(e,location).href))});this.#t=c.terminate,this.ffi={assign:c.assign,direct:c.direct,evaluate:c.evaluate,gather:c.gather,query:c.query},o[s]=c.reflect}terminate(){this.#t(),super.terminate()}}return{...a,Worker:o}};const{WebSocket:zt}=globalThis;var qt=e=>{const{ws:r}=e,s=It(e);class n extends s.Worker{#r=null;constructor(e,s){const{proxy:n}=super(e,s),[c,i]=t(Number),[l,u]=c(),f=n[o],p=this.#r=new zt(r);p.onerror=console.error,p.onclose=()=>super.terminate(),p.onopen=async()=>{p.send(await Ae([a])),i(l)},p.onmessage=async e=>{const t=Be(await e.data.arrayBuffer());if("number"==typeof t[0])i.apply(null,t);else{try{t[1]=await f(...t[1])}catch(e){t[1]=null,t[2]=e}p.send(await Ae(t))}},n[a]=async(...e)=>{await u;const[t,r]=c();return p.send(await Ae([t,e])),r}}terminate(){this.#r.close(),super.terminate()}}return{...s,Worker:n}};export{qt as default};
