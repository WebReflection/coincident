var e=Promise.withResolvers.bind(Promise),t=(t=e=>e)=>{const r=new Map;let s=0;return[()=>{let n;do{n=t(s++)}while(r.has(n));const a=e();return r.set(n,a),[n,a.promise]},(e,t,s)=>{const n=r.get(e);r.delete(e),s?n?.reject(s):n?.resolve(t)}]};const r="e82c94fb",s="="+r,n="-"+r,a=s+"-ws",o=n+"-ws";let c=0;const i=c++,l=c++,u=c++,f=c++,p=c++,h=c++,g=c++,d=c++,y=c++,b=c++,w=c++,m=c++,v=c++,k=c++,T=c++,x=c++,M=c++,S=c++,E=c++,A=c++,O=c++,B=c++,R=c++,L=c++,P=c++,U=c++;const $=globalThis.ImageData||class{},W=new TextDecoder,j=new TextEncoder,N=new Map(Reflect.ownKeys(Symbol).map(e=>[Symbol[e],`@${String(e)}`])),F=e=>{switch(e[0]){case"@":return Symbol[e.slice(1)];case"#":return Symbol.for(e.slice(1));case"!":return Symbol(e.slice(1));default:return Symbol()}},_=e=>N.get(e)||((e,t)=>void 0===t?"?":void 0===Symbol.keyFor(e)?`!${t}`:`#${t}`)(e,e.description),D=Object.defineProperty,I=Object.assign,z=Array.from,q=Array.isArray,C=ArrayBuffer.isView,J=(e,t)=>[e,t],K=e=>e,H={},V=e=>(t,r=new Map)=>{for(let s=0,n=t.length;s<n;s++)t[s]=e(t[s],r);return t},Y=([e,t])=>0===e?t:F(t),X=e=>"string"==typeof e?J(0,e):J(16,_(e)),G=new ArrayBuffer(8),Q=new DataView(G),Z=new Uint8Array(G),ee=(e,t,r)=>(e.set(t,r),r),te=e=>{Z[0]=e[ne++],Z[1]=e[ne++],Z[2]=e[ne++],Z[3]=e[ne++],Z[4]=e[ne++],Z[5]=e[ne++],Z[6]=e[ne++],Z[7]=e[ne++]},re=e=>(Z[0]=e[ne++],Z[1]=e[ne++],Z[2]=e[ne++],Z[3]=e[ne++],Q.getUint32(0,!0)),se=(e,t)=>{switch(e[ne++]){case p:return te(e),Q.getFloat64(0,!0);case h:return e[ne++];case O:{const r=ee(t,ne-1,{});for(let s=0,n=re(e);s<n;s++)r[se(e,t)]=se(e,t);return r}case x:{const r=ee(t,ne-1,[]);for(let s=0,n=re(e);s<n;s++)r.push(se(e,t));return r}case L:{const r=ne-1,s=se(e,t);return ee(t,r,new globalThis[s](se(e,t)))}case M:{const r=ne-1,s=re(e);return ee(t,r,e.slice(ne,ne+=s).buffer)}case k:{const r=ne-1,s=re(e);return ee(t,r,W.decode(e.slice(ne,ne+=s)))}case S:return ee(t,ne-1,new Date(se(e,t)));case A:{const r=ee(t,ne-1,new Map);for(let s=0,n=re(e);s<n;s++)r.set(se(e,t),se(e,t));return r}case R:{const r=ee(t,ne-1,new Set);for(let s=0,n=re(e);s<n;s++)r.add(se(e,t));return r}case E:{const r=se(e,t),s=se(e,t),n=se(e,t),a=new(globalThis[r]||Error)(s);return ee(t,ne-1,D(a,"stack",{value:n}))}case P:{const r=se(e,t),s=se(e,t),n=se(e,t),a=se(e,t),o=se(e,t);return ee(t,ne-1,new $(r,s,n,{colorSpace:a,pixelFormat:o}))}case B:{const r=se(e,t),s=se(e,t);return ee(t,ne-1,new RegExp(r,s))}case i:return!1;case l:return!0;case g:return NaN;case d:return 1/0;case y:return-1/0;case b:return 0;case w:return-0;case f:return null;case m:return te(e),Q.getBigInt64(0,!0);case v:return te(e),Q.getBigUint64(0,!0);case T:return F(se(e,t));case U:return t.get(re(e));default:return}};let ne=0;class ae{static push(e,t){e.sync(!1),e._(t,t.length)}constructor(e,t){const r=[];this.l=0,this.o=r,this.v=new Uint8Array(e,t),this.push=r.push.bind(r)}get length(){return this.l+this.o.length}sync(e){const t=this.o,r=t.length;r&&this._(e?t:t.splice(0),r)}_(e,t){const{buffer:r,byteOffset:s}=this.v,n=this.l;this.l+=t,t+=s+n,r.byteLength<t&&r.grow(t),this.v.set(e,n)}}const{getPrototypeOf:oe}=Object,{construct:ce}=Reflect,{toStringTag:ie}=Symbol,{toString:le}=H,ue=(e,t=e[ie])=>t in globalThis?t:ue(ce(oe(e.constructor),[0])),{isNaN:fe,isFinite:pe,isInteger:he}=Number,{ownKeys:ge}=Reflect,{is:de}=Object,ye=(e,t,r)=>{const s=r.get(e),n=!s;return n?(Q.setUint32(0,t.length,!0),r.set(e,[Z[0],Z[1],Z[2],Z[3]])):t.push(U,s[0],s[1],s[2],s[3]),n},be=(e,t,r)=>{Q.setUint32(0,r,!0),e.push(t,Z[0],Z[1],Z[2],Z[3])},we=(e,t,r)=>{switch(typeof e){case"number":e&&pe(e)?he(e)&&e<256&&-1<e?t.push(h,e):(Q.setFloat64(0,e,!0),t.push(p,Z[0],Z[1],Z[2],Z[3],Z[4],Z[5],Z[6],Z[7])):fe(e)?t.push(g):e?t.push(e<0?y:d):t.push(de(e,0)?b:w);break;case"object":switch(!0){case null===e:t.push(f);break;case!ye(e,t,r):break;case q(e):{const s=e.length;be(t,x,s);for(let n=0;n<s;n++)we(e[n],t,r);break}case C(e):if(t.push(L),we(ue(e),t,r),e=e.buffer,!ye(e,t,r))break;case e instanceof ArrayBuffer:{const r=new Uint8Array(e);be(t,M,r.length),me(t,r);break}case e instanceof Date:t.push(S),we(e.getTime(),t,r);break;case e instanceof Map:be(t,A,e.size);for(const[s,n]of e)we(s,t,r),we(n,t,r);break;case e instanceof Set:be(t,R,e.size);for(const s of e)we(s,t,r);break;case e instanceof Error:t.push(E),we(e.name,t,r),we(e.message,t,r),we(e.stack,t,r);break;case e instanceof $:t.push(P),we(e.data,t,r),we(e.width,t,r),we(e.height,t,r),we(e.colorSpace,t,r),we(e.pixelFormat,t,r);break;case e instanceof RegExp:t.push(B),we(e.source,t,r),we(e.flags,t,r);break;default:if("toJSON"in e){const s=e.toJSON();we(s===e?null:s,t,r)}else{const s=ge(e),n=s.length;be(t,O,n);for(let a=0;a<n;a++){const n=s[a];we(n,t,r),we(e[n],t,r)}}}break;case"string":if(ye(e,t,r)){const r=j.encode(e);be(t,k,r.length),me(t,r)}break;case"boolean":t.push(e?l:i);break;case"symbol":t.push(T),we(_(e),t,r);break;case"bigint":{let r=m;9223372036854775807n<e?(Q.setBigUint64(0,e,!0),r=v):Q.setBigInt64(0,e,!0),t.push(r,Z[0],Z[1],Z[2],Z[3],Z[4],Z[5],Z[6],Z[7]);break}default:t.push(u)}};let me=(e,t)=>{for(let r=e.push,s=0,n=t.length;s<n;s+=32767)r.apply(e,t.subarray(s,s+32767))};const ve=({byteOffset:e=0,Array:t=ae}={})=>(r,s)=>{const n=new t(s,e);me=t.push,we(r,n,new Map);const a=n.length;return n.sync(!0),a};let ke=class extends ArrayBuffer{value;transferToFixedLength(e){return this.value=new ArrayBuffer(e)}};const Te=new ke,xe=ve({Array:class extends ae{constructor(e,t){super(e,t),this.e=[]}sync(e){if(super.sync(e),e){const e=this.l,t=this.v.byteOffset,r=this.v.buffer.transferToFixedLength(e+t),s=new Uint8Array(r,t);for(let e=this.e,t=0,r=0;r<e.length;r++){const n=e[r];s.set(n,t),t+=n.length}}return this}_(e,t){this.l+=t,this.e.push(e)}}}),Me=e=>xe(e,Te)?Te.value:Te,Se=e=>{return t=new Uint8Array(e),ne=0,se(t,new Map);var t};let Ee=0;const Ae=Ee++,Oe=Ee++,Be=Ee++,Re=Ee++,Le=Ee++,Pe=Ee++,Ue=Ee++,$e=Ee++,We=Ee++,je=Ee++,Ne=Ee++,Fe=Ee++,_e=Ee++,De=Ee++,Ie=Ee++;Ee++;const ze=Ee++,qe=Ee++,Ce=(e,t)=>[t?e:z(new Uint8Array(e)),e.resizable?e.maxByteLength:0],Je=/\[('|")?(.+?)\1\]/g,Ke=(e,t)=>e?.[t];var He=(e,t)=>t.replace(Je,".$2").split(".").reduce(Ke,e),Ve=(e,...t)=>t.map(Ye,e);function Ye(e){return"string"==typeof e?He(this,e):this[e]}const Xe=globalThis.Node||class{},{apply:Ge,construct:Qe,defineProperty:Ze,deleteProperty:et,get:tt,getOwnPropertyDescriptor:rt,getPrototypeOf:st,has:nt,isExtensible:at,ownKeys:ot,set:ct,setPrototypeOf:it}=Reflect;var lt=({reflect:e=K,transform:t=K,remote:r=K,module:s=e=>import(e),buffer:n=!1,timeout:a=-1}=H)=>{const o=(t,s=new Map)=>{if(!q(t))return t;const[n,a]=t;switch(n){case 2:{if(null===a)return globalThis;let e=s.get(t);if(!e){e=a,s.set(t,a);for(const e in a)a[e]=o(a[e],s)}return e}case 4:return s.get(t)||(s.set(t,a),i(a,s));case 8:{let t=b.get(a),s=t?.deref();return s||(t&&m.unregister(t),s=function(...t){r.apply(this,t);for(let e=0,r=t.length;e<r;e++)t[e]=c(t[e]);return e(Pe,a,c(this),t).then(o)},t=new WeakRef(s),b.set(a,t),m.register(s,a,t)),s}case 16:return F(a);default:return 1&n?h(a):a}},c=e=>{switch(typeof e){case"object":{if(null===e)break;if(e===globalThis)return w;const r=t(e);return k&&v.has(r)||r instanceof $?J(0,r):C(r)?J(68,((e,t)=>{const{BYTES_PER_ELEMENT:r,byteOffset:s,buffer:n,length:a}=e;return[ue(e),Ce(n,t),s,a!==(n.byteLength-s)/r?a:0]})(r,n)):r instanceof ArrayBuffer?J(64,Ce(r,n)):J(q(r)?5:3,p(r))}case"function":return J(9,p(t(e)));case"symbol":return J(16,_(e));case"bigint":return J(32,e.toString())}return e},i=V(o),l=V(Y),u=V(X),{clear:f,id:p,ref:h,unref:g}=((e=0,t=new Map,r=new Map)=>({clear:()=>{t.clear(),r.clear()},id:s=>{let n=r.get(s);if(void 0===n){for(;t.has(n=e++););t.set(n,s),r.set(s,n)}return n},ref:e=>t.get(e),unref:e=>(r.delete(t.get(e)),t.delete(e))}))(),d=/^(?:[0-9]+|length)$/,y=-1<a,b=new Map,w=J(2,null),m=new FinalizationRegistry(t=>{b.delete(t),e(Ae,t)});let v,k=!1;return{assign:I,gather:Ve,query:He,direct:e=>(k||(k=!0,v=new WeakSet),v.add(e),e),evaluate:(e,...t)=>Ge(e,null,t),reflect(e,t,...r){const n=null===t,a=n?globalThis:h(t);switch(e){case je:{const e=Y(r[0]),t=n&&"import"===e,o=t?s:tt(a,e),i=c(o);if(!y)return i;let l,u=t,f=a;if(!t&&!(f instanceof Xe||q(f)&&"string"==typeof e&&d.test(e)))if(e in a){for(;!(l=rt(f,e))&&(f=st(f),f););u=!!l&&"value"in l}else u=!0;return[u,i]}case Pe:{const e=new Map;return c(Ge(a,o(r[0],e),i(r[1],e)))}case ze:return ct(a,Y(r[0]),o(r[1]));case _e:return nt(a,Y(r[0]));case Ie:return u(ot(a),b);case Ue:return c(Qe(a,i(r[0])));case Ne:{const e=rt(a,Y(r[0]));if(e)for(const t in e)e[t]=c(e[t]);return e}case $e:return Ze(a,Y(r[0]),o(r[1]));case We:return et(a,Y(r[0]));case Fe:return c(st(a));case qe:return it(a,o(r[0]));case Oe:return void I(a,o(r[0]));case Be:{const e=o(r[0]),t=Function(`return(${e}).apply(null,arguments)`);return c(Ge(t,null,i(r[1])))}case Re:for(let e,t=0,s=(r=l(r[0],b)).length;t<s;t++)e=r[t],r[t]=c("string"==typeof e?He(a,e):a[e]);return r;case Le:return c(He(a,r[0]));case Ae:return g(t);case De:return at(a)}},terminate(){for(const e of b.values())m.unregister(e);b.clear(),f()}}};const{addEventListener:ut}=EventTarget.prototype,ft=new WeakMap;Reflect.defineProperty(EventTarget.prototype,"addEventListener",{value(e,t,r){const s=r?.invoke;if(s){let t=ft.get(this);t||ft.set(this,t=new Map),t.set(e,[].concat(s)),delete r.invoke}return ut.apply(this,arguments)}});const pt=[],ht=new WeakSet,gt=(...e)=>(ht.add(e),e);let{SharedArrayBuffer:dt}=globalThis,yt=!0;try{new dt(4,{maxByteLength:8})}catch(e){yt=!1,dt=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const{assign:bt,create:wt}=Object,mt=`coincident-${yt?crypto.randomUUID():Math.random().toString(36).substring(2)}`,vt={byteOffset:2*Int32Array.BYTES_PER_ELEMENT},kt=(e,t,r)=>{const s="then"!==t;return s&&(e[t]=r),s},Tt=e=>{e.stopImmediatePropagation(),e.preventDefault()},xt=(e,t=-1)=>e?.reflected_ffi_timeout??t,{defineProperty:Mt}=Object,[St,Et]=t();let[At,Ot]=St(),Bt=()=>Ot,{Atomics:Rt,MessageChannel:Lt,Worker:Pt}=globalThis;if(yt)Et(At);else{const t=new Map,r=(e,...t)=>{e.addEventListener(...t)};if("importScripts"in globalThis){r(globalThis,"message",e=>{Tt(e),Et(At,e.data)},{once:!0});const{wait:e}=Rt,{parse:s}=JSON,n=e=>{const r=new XMLHttpRequest;try{if(r.timeout=3e3,r.open("POST",`${c}?sabayon`,!1),r.setRequestHeader("Content-Type","application/json"),r.send(`["${o}",${t.get(e)}]`),200===r.status)return r;throw r}catch{return r.abort(),n(e)}},a=(e,t)=>(e.set(s(t.responseText)),"ok");let o,c;Rt={wait:(r,...s)=>t.has(r)?a(r,n(r)):e(r,...s)},Ot=Ot.then(e=>{[o,c]=e})}else{const s=[mt,Math.random()].join("-").replace(/\W/g,"-"),n=new BroadcastChannel("dc78209b-186c-4f83-80e9-406becb7d9f3");n.onmessage=async e=>{const[r,a,o]=e.data;if(a===s)for(const[e,[s,a]]of t)if(s===o){await a.promise;let t=e.length;for(;t--&&!e[t];);n.postMessage([r,e.slice(0,t+1)]);break}};const a=r=>{const[s,n,a]=r.data;t.set(n,[s,e()]),Mt(r,"data",{value:a})};Lt=class extends Lt{constructor(){super(),r(this.port1,"message",a)}},Pt=class extends Pt{constructor(e,t){super(e,t),super.postMessage([s,c])}};const{notify:o}=Rt;Rt={notify(e,...r){const s=t.get(e);return s?(s[1].resolve(),0):o(e,...r)}};let c="",i=null;const l=(e,t)=>{let s,n=!0;e.getRegistration(c).then(r=>r??e.register(c,t)).then(function t(a){const{controller:o}=e;if(n=n&&!!o,s=a.installing||a.waiting||a.active,"activated"===s.state){if(n){if(o.scriptURL===c)return Et(At);a.unregister()}location.reload()}else r(s,"statechange",()=>t(a),{once:!0})})};Bt=(e,t)=>{if(!i){const r=new URL(e,location.href);c=`${r.protocol}//${r.host}${r.pathname}`,l(navigator.serviceWorker,t),i=Ot}return i}}}const Ut="InstallTrigger"in globalThis?mt:"",$t=e=>e,Wt=e=>e===s?"main":e===n?"worker":e;class jt extends Event{#e;constructor(e){super("message"),this.#e=e}get data(){return this.#e}}var Nt=e=>{const r=e?.transform,s=xt(e),n=(e?.encoder||ve)(vt),a=!1!==e?.transfer;return{Worker:class extends Pt{constructor(e,o){const c=yt?"":o?.serviceWorker||"",{notify:i}=c?Rt:Atomics,{port1:l,port2:u}=new(c?Lt:MessageChannel),[f,p]=t($t),h=new Map,g=wt(null);c&&Bt(c);let d="";super(e,bt({type:"module"},o)),this.proxy=new Proxy(g,{get:(e,t)=>{if("then"===t)return;let s=h.get(t);return s||h.set(t,s=(...e)=>{const s=((e,t)=>{let r=pt;return e&&ht.has(t.at(-1)||pt)&&(r=t.pop(),ht.delete(r)),r})(a,e),[n,o]=f();return l.postMessage([n,t,r?e.map(r):e],s),((e,t)=>{if(d){const r=setTimeout(console.warn,3e3,`ðŸ’€ðŸ”’ - is proxy.${Wt(d)}() awaiting proxy.${Wt(t)}() ?`);e=e.then(e=>(clearTimeout(r),e),e=>(clearTimeout(r),Promise.reject(e)))}return e})(o,t)}),s},set:kt}),Ut&&(yt||c)&&super.addEventListener("message",e=>{const{data:t}=e;t?.ID===Ut&&(Tt(e),l.dispatchEvent(new jt(t.data)))}),super.postMessage([Ut,c,xt(o,s)],[u]),l.addEventListener("message",async({data:e})=>{const t=e[0],s=typeof t;if("number"===s)p.apply(null,e);else if(d=e[1],await(async(e,t,r)=>{try{const s=await t[e[1]].apply(null,e[2]);e[1]=r?r(s):s,e[2]=null}catch(t){e[2]=t}})(e,g,r),d="","string"===s)l.postMessage(e);else{const r=e[2]||e[1];t[1]=void 0===r?0:n(r,t.buffer),t[0]=1,i(t,0)}}),l.start()}},native:yt,transfer:gt}},Ft=e=>{const t=e?.import,r=xt(e),a=Nt({...e,encoder:e?.encoder||ve});class o extends a.Worker{#t;constructor(e,a){const{proxy:o}=super(e,a),c=lt({...a,buffer:!0,reflect:o[n],timeout:xt(a,r),remote(e){e instanceof Event&&(e=>{const{currentTarget:t,target:r,type:s}=e,n=ft.get(t||r)?.get(s);if(n)for(const t of n)e[t]()})(e)},module:a?.import||t||(e=>import(new URL(e,location).href))});this.#t=c.terminate,this.ffi={assign:c.assign,direct:c.direct,evaluate:c.evaluate,gather:c.gather,query:c.query},o[s]=c.reflect}terminate(){this.#t(),super.terminate()}}return{...a,Worker:o}};const{WebSocket:_t}=globalThis;var Dt=e=>{const{ws:r}=e,s=Ft(e);class n extends s.Worker{#r=null;constructor(e,s){const{proxy:n}=super(e,s),[c,i]=t(Number),[l,u]=c(),f=n[o],p=this.#r=new _t(r);p.onerror=console.error,p.onclose=()=>super.terminate(),p.onopen=()=>{p.send(Me([a])),i(l)},p.onmessage=async e=>{const t=Se(await e.data.arrayBuffer());if("number"==typeof t[0])i.apply(null,t);else{try{t[1]=await f(...t[1])}catch(e){t[1]=null,t[2]=e}p.send(Me(t))}},n[a]=async(...e)=>{await u;const[t,r]=c();return p.send(Me([t,e])),r}}terminate(){this.#r.close(),super.terminate()}}return{...s,Worker:n}};export{Dt as default};
