const e="2e5a9143",t="="+e,s="-"+e;var n=Promise.withResolvers.bind(Promise),r=(e=e=>e)=>{const t=new Map;let s=0;return[()=>{let r;do{r=e(s++)}while(t.has(r));const a=n();return t.set(r,a),[r,a.promise]},(e,s,n)=>{const r=t.get(e);t.delete(e),n?r?.reject(n):r?.resolve(s)}]};let a=0;const o=a++,i=a++,c=a++,l=a++,p=a++,u=a++,h=a++,f=a++,g=a++,y=a++,b=a++,d=a++,m=a++,w=a++,k=a++,v=a++,x=a++,U=a++,R=a++,T=a++,$=a++,L=a++,M=a++,j=a++,O=a++,A=a++,S=a++,B=a++;const E=globalThis.ImageData||class{};class P{static push(e,t){e.sync(!1),e._(t,t.length)}constructor(e,t){const s=[];this.l=0,this.o=s,this.v=new Uint8Array(e,t),this.push=s.push.bind(s)}get length(){return this.l+this.o.length}sync(e){const t=this.o,s=t.length;s&&this._(e?t:t.splice(0),s)}_(e,t){const{buffer:s,byteOffset:n}=this.v,r=this.l;this.l+=t,t+=n+r,s.byteLength<t&&s.grow(t),this.v.set(e,r)}}const I=new Map(Reflect.ownKeys(Symbol).map(e=>[Symbol[e],`@${String(e)}`])),D=e=>I.get(e)||((e,t)=>void 0===t?"?":void 0===Symbol.keyFor(e)?`!${t}`:`#${t}`)(e,e.description),N=Array.isArray,W=ArrayBuffer.isView;new TextDecoder;const _=new TextEncoder,z=new ArrayBuffer(8),F=new DataView(z),C=new Uint8Array(z),{getPrototypeOf:J}=Object,{construct:q}=Reflect,{toStringTag:H}=Symbol,K=(e,t=e[H])=>t in globalThis?t:K(q(J(e.constructor),[0])),{isNaN:V,isFinite:X,isInteger:Y}=Number,{ownKeys:G}=Reflect,{is:Q}=Object,Z=(e,t,s)=>{const n=s.get(e),r=!n;return r?(F.setUint32(0,t.length,!0),s.set(e,[C[0],C[1],C[2],C[3]])):t.push(B,n[0],n[1],n[2],n[3]),r},ee=(e,t,s)=>{F.setUint32(0,s,!0),e.push(t,C[0],C[1],C[2],C[3])},te=(e,t,s)=>{switch(typeof e){case"number":e&&X(e)?Y(e)&&e<256&&-1<e?t.push(u,e):(F.setFloat64(0,e,!0),t.push(p,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7])):V(e)?t.push(h):e?t.push(e<0?g:f):t.push(Q(e,0)?y:b);break;case"object":switch(!0){case null===e:t.push(l);break;case!Z(e,t,s):break;case N(e):{const n=e.length;ee(t,v,n);for(let r=0;r<n;r++)te(e[r],t,s);break}case W(e):if(t.push(j),te(K(e),t,s),e=e.buffer,!Z(e,t,s))break;case e instanceof ArrayBuffer:{const s=new Uint8Array(e);ee(t,x,s.length),ne(t,s);break}case e instanceof Date:t.push(U),te(e.getTime(),t,s);break;case e instanceof Map:ee(t,T,e.size);for(const[n,r]of e)te(n,t,s),te(r,t,s);break;case e instanceof Set:ee(t,M,e.size);for(const n of e)te(n,t,s);break;case e instanceof Error:t.push(R),te(e.name,t,s),te(e.message,t,s),te(e.stack,t,s);break;case e instanceof E:t.push(O),te(e.data,t,s),te(e.width,t,s),te(e.height,t,s),te(e.colorSpace,t,s),te(e.pixelFormat,t,s);break;case e instanceof RegExp:t.push(L),te(e.source,t,s),te(e.flags,t,s);break;case e instanceof File:t.push(S),te(e.name,t,s),te(e.lastModified,t,s);case e instanceof Blob:{const n=e.size;t.push(A),te(e.type,t,s),te(n,t,s);const r=t.length;ne(t,new Uint8Array(n)),se.push(e.arrayBuffer().then(e=>[r,e]));break}default:if("toJSON"in e){const n=e.toJSON();te(n===e?null:n,t,s)}else{const n=G(e),r=n.length;ee(t,$,r);for(let a=0;a<r;a++){const r=n[a];te(r,t,s),te(e[r],t,s)}}}break;case"string":if(Z(e,t,s)){const s=_.encode(e);ee(t,w,s.length),ne(t,s)}break;case"boolean":t.push(e?i:o);break;case"symbol":t.push(k),te(D(e),t,s);break;case"bigint":{let s=d;9223372036854775807n<e?(F.setBigUint64(0,e,!0),s=m):F.setBigInt64(0,e,!0),t.push(s,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7]);break}default:t.push(c)}},se=[];let ne=(e,t)=>{for(let s=e.push,n=0,r=t.length;n<r;n+=32767)s.apply(e,t.subarray(n,n+32767))};const re=({byteOffset:e=0,Array:t=P}={})=>(s,n)=>{const r=new t(n,e);ne=t.push,te(s,r,new Map);const a=r.length;return r.sync(!0),se.length?Promise.all(se.splice(0)).then(t=>{const s=new Uint8Array(n,e);for(const[e,n]of t)s.set(new Uint8Array(n),e);return a}):a},ae=[],oe=new WeakSet,ie=(...e)=>(oe.add(e),e);let{SharedArrayBuffer:ce}=globalThis,le=!0;try{new ce(4,{maxByteLength:8})}catch(e){le=!1,ce=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const{assign:pe,create:ue}=Object,he=`coincident-${le?crypto.randomUUID():Math.random().toString(36).substring(2)}`,fe={byteOffset:2*Int32Array.BYTES_PER_ELEMENT},ge=(e,t,s)=>{const n="then"!==t;return n&&(e[t]=s),n},ye=e=>{e.stopImmediatePropagation(),e.preventDefault()},be=(e,t=-1)=>e?.reflected_ffi_timeout??t,{defineProperty:de}=Object,[me,we]=r();let[ke,ve]=me(),xe=()=>ve,{Atomics:Ue,MessageChannel:Re,Worker:Te}=globalThis;if(le)we(ke);else{const e=new Map,t=(e,...t)=>{e.addEventListener(...t)};if("importScripts"in globalThis){t(globalThis,"message",e=>{ye(e),we(ke,e.data)},{once:!0});const{wait:s}=Ue,{parse:n}=JSON,r=t=>{const s=new XMLHttpRequest;try{if(s.timeout=3e3,s.open("POST",`${i}?sabayon`,!1),s.setRequestHeader("Content-Type","application/json"),s.send(`["${o}",${e.get(t)}]`),200===s.status)return s;throw s}catch{return s.abort(),r(t)}},a=(e,t)=>(e.set(n(t.responseText)),"ok");let o,i;Ue={wait:(t,...n)=>e.has(t)?a(t,r(t)):s(t,...n)},ve=ve.then(e=>{[o,i]=e})}else{const s=[he,Math.random()].join("-").replace(/\W/g,"-"),r=new BroadcastChannel("dc78209b-186c-4f83-80e9-406becb7d9f3");r.onmessage=async t=>{const[n,a,o]=t.data;if(a===s)for(const[t,[s,a]]of e)if(s===o){await a.promise;let e=t.length;for(;e--&&!t[e];);r.postMessage([n,t.slice(0,e+1)]);break}};const a=t=>{const[s,r,a]=t.data;e.set(r,[s,n()]),de(t,"data",{value:a})};Re=class extends Re{constructor(){super(),t(this.port1,"message",a)}},Te=class extends Te{constructor(e,t){super(e,t),super.postMessage([s,i])}};const{notify:o}=Ue;Ue={notify(t,...s){const n=e.get(t);return n?(n[1].resolve(),0):o(t,...s)}};let i="",c=null;const l=(e,s)=>{let n,r=!0;e.getRegistration(i).then(t=>t??e.register(i,s)).then(function s(a){const{controller:o}=e;if(r=r&&!!o,n=a.installing||a.waiting||a.active,"activated"===n.state){if(r){if(o.scriptURL===i)return we(ke);a.unregister()}location.reload()}else t(n,"statechange",()=>s(a),{once:!0})})};xe=(e,t)=>{if(!c){const s=new URL(e,location.href);i=`${s.protocol}//${s.host}${s.pathname}`,l(navigator.serviceWorker,t),c=ve}return c}}}const $e="InstallTrigger"in globalThis?he:"",Le=e=>e,Me=e=>e===t?"main":e===s?"worker":e;class je extends Event{#e;constructor(e){super("message"),this.#e=e}get data(){return this.#e}}var Oe=e=>{const t=e?.transform,s=be(e),n=(e?.encoder||re)(fe),a=!1!==e?.transfer;return{Worker:class extends Te{constructor(e,o){const i=le?"":o?.serviceWorker||"",{notify:c}=i?Ue:Atomics,{port1:l,port2:p}=new(i?Re:MessageChannel),[u,h]=r(Le),f=new Map,g=ue(null);i&&xe(i);let y="";super(e,pe({type:"module"},o)),this.proxy=new Proxy(g,{get:(e,s)=>{if("then"===s)return;let n=f.get(s);return n||f.set(s,n=(...e)=>{const n=((e,t)=>{let s=ae;return e&&N(t.at(-1))&&oe.has(t.at(-1))&&(s=t.pop(),oe.delete(s)),s})(a,e),[r,o]=u();return l.postMessage([r,s,t?e.map(t):e],n),((e,t)=>{if(y){const s=setTimeout(console.warn,3e3,`ðŸ’€ðŸ”’ - is proxy.${Me(y)}() awaiting proxy.${Me(t)}() ?`);e=e.then(e=>(clearTimeout(s),e),e=>(clearTimeout(s),Promise.reject(e)))}return e})(o,s)}),n},set:ge}),$e&&(le||i)&&super.addEventListener("message",e=>{const{data:t}=e;t?.ID===$e&&(ye(e),l.dispatchEvent(new je(t.data)))}),super.postMessage([$e,i,be(o,s)],[p]),l.addEventListener("message",async({data:e})=>{const s=e[0],r=typeof s;if("number"===r)h.apply(null,e);else if(y=e[1],await(async(e,t,s)=>{try{const n=await t[e[1]].apply(null,e[2]);e[1]=s?s(n):n,e[2]=null}catch(t){e[2]=t}})(e,g,t),y="","string"===r)l.postMessage(e);else{const t=e[2]||e[1],r=void 0===t?0:n(t,s.buffer);s[1]="number"==typeof r?r:await r,s[0]=1,c(s,0)}}),l.start()}},native:le,transfer:ie}};const Ae=e=>new URL(e,location.href),{href:Se}=new URL("./worker.js",import.meta.url),{assign:Be,keys:Ee}=Object,Pe=new Map;let Ie;var De=(e,t)=>{const s="string"!=typeof e;if(Ie??=Oe(s?e:t),s)return Ie;const{Worker:n}=Ie,{href:r}=Ae(e);let a,o=Pe.get(r);if(!o){const e=crypto.randomUUID(),{promise:s,resolve:i}=Promise.withResolvers();if(t?.worker){const o=new Blob([`import coincident from '${Se}';`,`import * as $ from '${r}';`,"const{assign:a,keys:k}=Object,{proxy:p}=await coincident();",`a(p,$);p['${e}'](k($))`],{type:"text/javascript"}),c=URL.createObjectURL(o);s.then(()=>URL.revokeObjectURL(c)),a=new n(c,{...t,type:"module"}),a.proxy[e]=i}else a={proxy:null,terminate(){this.proxy=null}},import(r).then(e=>i(Ee(a.proxy=e)));o={terminate:()=>{Pe.delete(r),a.terminate()},for(e){const r=new Blob([`import coincident from '${Se}';`,"const{proxy:p}=await coincident();globalThis.sync={};","for(let k of p.keys())sync[k]=(...a)=>p.invoke(k,a);",`await import('${Ae(e)}')`],{type:"text/javascript"}),o=URL.createObjectURL(r),i=new n(o,{...t,type:"module"});return i.proxy.keys=()=>s,i.proxy.invoke=(e,t)=>a.proxy[e](...t),{terminate:()=>{URL.revokeObjectURL(o),i.terminate()}}}},Pe.set(r,Be(o,Ie))}return o};export{De as default};
