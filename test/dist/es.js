const e="function",t="566fc334-5147-4e86-bb9b-c7d24c13127d",s="get",n="has",a="set",{isArray:o}=Array;let{SharedArrayBuffer:r,window:i}=globalThis,{notify:l,wait:c,waitAsync:f}=Atomics,d=null;f||(f=e=>({value:new Promise((t=>{let s=new Worker("data:application/javascript,onmessage%3D(%7Bdata%3Ab%7D)%3D%3E(Atomics.wait(b%2C0)%2CpostMessage(0))");s.onmessage=t,s.postMessage(e)}))}));try{new r(4)}catch(e){r=ArrayBuffer;const s=new WeakMap;if(i){const e=new Map,{prototype:{postMessage:n}}=Worker,a=s=>{const n=s.data?.[t];if(!o(n)){s.stopImmediatePropagation();const{id:t,sb:a}=n;e.get(t)(a)}};d=function(e,...r){const i=e?.[t];if(o(i)){const[e,t]=i;s.set(t,e),this.addEventListener("message",a)}return n.call(this,e,...r)},f=t=>({value:new Promise((n=>{e.set(s.get(t),n)})).then((n=>{e.delete(s.get(t)),s.delete(t);for(let e=0;e<n.length;e++)t[e]=n[e];return"ok"}))})}else{const e=(e,s)=>({[t]:{id:e,sb:s}});l=t=>{postMessage(e(s.get(t),t))},addEventListener("message",(e=>{const n=e.data?.[t];if(o(n)){const[e,t]=n;s.set(t,e)}}))}}
/*! (c) Andrea Giammarchi - ISC */const{Int32Array:g,Map:p,Uint16Array:w}=globalThis,{BYTES_PER_ELEMENT:u}=g,{BYTES_PER_ELEMENT:h}=w,y=new WeakSet,m=new WeakMap,E={value:{then:e=>e()}};let b=0;const A=(i,{parse:A=JSON.parse,stringify:M=JSON.stringify,transform:v,interrupt:T}=JSON)=>{if(!m.has(i)){const P=d||i.postMessage,k=(e,...s)=>P.call(i,{[t]:s},{transfer:e}),S=typeof T===e?T:T?.handler,W=T?.delay||42,B=new TextDecoder("utf-16"),L=(e,t)=>e?f(t,0):(S?((e,t,s)=>{for(;"timed-out"===c(e,0,0,t);)s()})(t,W,S):c(t,0),E);let N=!1;m.set(i,new Proxy(new p,{[n]:(e,t)=>"string"==typeof t&&!t.startsWith("_"),[s]:(e,t)=>"then"===t?null:(...e)=>{const s=b++;let n=new g(new r(2*u)),a=[];y.has(e.at(-1)||a)&&y.delete(a=e.pop()),k(a,s,n,t,v?e.map(v):e);const o=i!==globalThis;let l=0;return N&&o&&(l=setTimeout(console.warn,1e3,`ðŸ’€ðŸ”’ - Possible deadlock if proxy.${t}(...args) is awaited`)),L(o,n).value.then((()=>{clearTimeout(l);const e=n[1];if(!e)return;const t=h*e;return n=new g(new r(t+t%u)),k([],s,n),L(o,n).value.then((()=>A(B.decode(new w(n.buffer).slice(0,e)))))}))},[a](s,n,a){const r=typeof a;if(r!==e)throw new Error(`Unable to assign ${n} as ${r}`);if(!s.size){const e=new p;i.addEventListener("message",(async n=>{const a=n.data?.[t];if(o(a)){n.stopImmediatePropagation();const[t,o,...r]=a;let i;if(r.length){const[n,a]=r;if(s.has(n)){N=!0;try{const r=await s.get(n)(...a);if(void 0!==r){const s=M(v?v(r):r);e.set(t,s),o[1]=s.length}}catch(e){i=e}finally{N=!1}}else i=new Error(`Unsupported action: ${n}`);o[0]=1}else{const s=e.get(t);e.delete(t);for(let e=new w(o.buffer),t=0;t<s.length;t++)e[t]=s.charCodeAt(t)}if(l(o,0),i)throw i}}))}return!!s.set(n,a)}}))}return m.get(i)};A.transfer=(...e)=>(y.add(e),e);export{A as default};
