/*! (c) Andrea Giammarchi - ISC */
const e="abd83994-8b06-4e38-8fd6-e7ff4490adca",{Atomics:t,Int32Array:n,Map:a,SharedArrayBuffer:s,Uint16Array:r}=globalThis,{BYTES_PER_ELEMENT:o}=n,{BYTES_PER_ELEMENT:i}=r,{fromCharCode:f}=String,c=new WeakMap;let d=0,w=[];const l=(l,{parse:g,stringify:E}=JSON)=>{if(!c.has(l)){const p=(t,n,a,s)=>l.postMessage({[e]:{id:t,sb:n,action:a,args:s}},{transfer:w.splice(0)});c.set(l,new Proxy(new a,{get:(e,a)=>(...e)=>{const c=d++;let l=new s(o),E=new n(l);e.at(-1)===w&&e.pop(),p(c,l,a,e),t.wait(E,0);const h=t.load(E,0),y=i*h;l=new s(y+y%o),E=new n(l),p(c,l),t.wait(E,0);let u="";for(let e=new r(l),n=0;n<h;n++)u+=f(t.load(e,n));return g(u)},set(s,o,i){if(!s.size){const o=new a;l.addEventListener("message",(async({data:a})=>{if(a?.[e]){const{action:i,args:f,id:c,sb:d}=a[e],w=new n(d);if(i){if(!s.has(i))throw new Error(`Unsupported action: ${i}`);{const e=E(await s.get(i)(...f));o.set(c,e),t.store(w,0,e.length),t.notify(w,0)}}else{const e=o.get(c);o.delete(c);for(let t=new r(d),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);t.notify(w,0)}}}))}return!!s.set(o,i)}}))}return c.get(l)};l.transfer=(...e)=>{w=e};export{l as default};
