/*! (c) Andrea Giammarchi - ISC */
const e="de4546b5-3651-4b6a-81cb-2260b14d7d87",{Atomics:t,Int32Array:n,Map:s,SharedArrayBuffer:r,Uint16Array:a}=globalThis,{BYTES_PER_ELEMENT:o}=n,{BYTES_PER_ELEMENT:i}=a,{fromCharCode:c}=String,d=new WeakMap;let f=0,w=[];const l=(l,{parse:g,stringify:E}=JSON)=>{if(!d.has(l)){const p=(t,n,s,r)=>l.postMessage({[e]:{id:t,sb:n,action:s,args:r}},{transfer:w.splice(0)});d.set(l,new Proxy(new s,{get:(e,s)=>(...e)=>{const d=f++;let l=new r(o),E=new n(l);e.at(-1)===w&&e.pop(),p(d,l,s,e),t.wait(E,0);const h=t.load(E,0),y=i*h;l=new r(y+y%o),E=new n(l),p(d,l),t.wait(E,0);let b="";for(let e=new a(l),n=0;n<h;n++)b+=c(t.load(e,n));return g(b)},set(r,o,i){if(!r.size){const o=new s;l.addEventListener("message",(async({data:s})=>{if(s?.[e]){const{action:i,args:c,id:d,sb:f}=s[e],w=new n(f);if(i){if(!r.has(i))throw new Error(`Unsupported action: ${i}`);{const e=E(await r.get(i)(...c));o.set(d,e),t.store(w,0,e.length),t.notify(w,0)}}else{const e=o.get(d);o.delete(d);for(let t=new a(f),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);t.notify(w,0)}}}))}return!!r.set(o,i)}}))}return d.get(l)};l.transfer=(...e)=>{w=e};export{l as default};
