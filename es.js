/*! (c) Andrea Giammarchi - ISC */
const e="b7c82a36-f339-49b3-bf4f-7c8ff13de3fc",{Atomics:t,Int32Array:n,Map:s,SharedArrayBuffer:r,Uint16Array:a}=globalThis,{BYTES_PER_ELEMENT:o}=n,{BYTES_PER_ELEMENT:i}=a,{load:f,notify:c,store:w,wait:l}=t,{fromCharCode:d}=String,g=new WeakMap;let E=0,p=[];const h=(t,{parse:h,stringify:y}=JSON)=>{if(!g.has(t)){const b=(n,s,r,a)=>t.postMessage({[e]:{id:n,sb:s,action:r,args:a}},{transfer:p.splice(0)});g.set(t,new Proxy(new s,{get:(e,t)=>(...e)=>{const s=E++;let c=new r(o),w=new n(c);e.at(-1)===p&&e.pop(),b(s,c,t,e),l(w,0);const g=f(w,0),y=i*g;c=new r(y+y%o),w=new n(c),b(s,c),l(w,0);let u="";for(let e=new a(c),t=0;t<g;t++)u+=d(f(e,t));return h(u)},set(r,o,i){if(!r.size){const o=new s;t.addEventListener("message",(async({data:t})=>{const s=t?.[e];if(s){const{action:e,args:t,id:i,sb:f}=s,l=new n(f);if(e){if(!r.has(e))throw new Error(`Unsupported action: ${e}`);{const n=y(await r.get(e)(...t));o.set(i,n),w(l,0,n.length)}}else{const e=o.get(i);o.delete(i);for(let t=new a(f),n=0;n<e.length;n++)t[n]=e.charCodeAt(n)}c(l,0)}}))}return!!r.set(o,i)}}))}return g.get(t)};h.transfer=(...e)=>{p=e};export{h as default};
