/*! (c) Andrea Giammarchi - ISC */
const e="905f4883-139d-4bed-bf2a-b4e61fec8475",{Atomics:t,Int32Array:n,Map:r,SharedArrayBuffer:s,Uint16Array:a}=globalThis,{BYTES_PER_ELEMENT:o}=n,{BYTES_PER_ELEMENT:f}=a,{load:i,notify:c,store:w,wait:d}=t,{isArray:l}=Array,{fromCharCode:g}=String,h=new WeakSet,E=new WeakMap;let p=0;const y=(t,{parse:y,stringify:u}=JSON)=>{if(!E.has(t)){const A=(n,...r)=>t.postMessage({[e]:r},{transfer:n});E.set(t,new Proxy(new r,{get:(e,t)=>(...e)=>{if("then"===t)return e[0]();const r=p++;let c=new s(o),w=new n(c),l=[];h.has(e.at(-1)||l)&&h.delete(l=e.pop()),A(l,r,c,t,e),d(w,0);const E=i(w,0),u=f*E;c=new s(u+u%o),w=new n(c),A([],r,c),d(w,0);let S="";for(let e=new a(c),t=0;t<E;t++)S+=g(i(e,t));return y(S)},set(s,o,f){if(!s.size){const o=new r;t.addEventListener("message",(async({data:t})=>{const r=t?.[e];if(l(r)){const[e,t,...f]=r,i=new n(t);if(f.length){const[t,n]=f;if(!s.has(t))throw new Error(`Unsupported action: ${t}`);{const r=u(await s.get(t)(...n));o.set(e,r),w(i,0,r.length)}}else{const n=o.get(e);o.delete(e);for(let e=new a(t),r=0;r<n.length;r++)e[r]=n.charCodeAt(r)}c(i,0)}}))}return!!s.set(o,f)}}))}return E.get(t)};y.transfer=(...e)=>(h.add(e),e);export{y as default};
