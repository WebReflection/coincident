/*! (c) Andrea Giammarchi - ISC */
const e="65e450a9-132e-4231-bc79-2f7c260d2fdc",{Atomics:t,Int32Array:n,Map:s,SharedArrayBuffer:r,Uint16Array:a}=globalThis,{BYTES_PER_ELEMENT:o}=n,{BYTES_PER_ELEMENT:c}=a,{isArray:i}=Array,{notify:f,wait:l}=t,{fromCharCode:w}=String,d=new WeakSet,g=new WeakMap;let h=0;const E=(t,{parse:E,stringify:p}=JSON)=>{if(!g.has(t)){const y=(n,...s)=>t.postMessage({[e]:s},{transfer:n});g.set(t,new Proxy(new s,{get:(e,t)=>"then"===t?null:(...e)=>{const s=h++;let i=new r(o);const f=new n(i);let g=[];d.has(e.at(-1)||g)&&d.delete(g=e.pop()),y(g,s,i,t,e),l(f,0);const p=f[0],u=c*p;return i=new r(u+u%o),y([],s,i),l(new n(i),0),E(w(...new a(i).slice(0,p)))},set(r,o,c){if(!r.size){const o=new s;t.addEventListener("message",(async({data:t})=>{const s=t?.[e];if(i(s)){const[e,t,...c]=s,i=new n(t);if(c.length){const[t,n]=c;if(!r.has(t))throw new Error(`Unsupported action: ${t}`);{const s=p(await r.get(t)(...n));o.set(e,s),i[0]=s.length}}else{const n=o.get(e);o.delete(e);for(let e=new a(t),s=0;s<n.length;s++)e[s]=n.charCodeAt(s)}f(i,0)}}))}return!!r.set(o,c)}}))}return g.get(t)};E.transfer=(...e)=>(d.add(e),e);export{E as default};
